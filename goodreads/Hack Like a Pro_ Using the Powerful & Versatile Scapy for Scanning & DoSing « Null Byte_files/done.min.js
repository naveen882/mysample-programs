(function(n,t){var i="post",r="comment",u=10,f=20,e=30,o={"cancel-edit":{label:"Cancel",side:"left",icon:"fa fa-chevron-circle-left",editorModes:[r,i],draftMode:null,validStates:[null,0,1,5,10,20,30,32,35,40,200,250]},preview:{label:"Preview",side:"right",icon:"fa fa-eye",editorModes:[i],draftMode:null,validStates:[null,0,1,5,10,20,30,32,35,40,200,250]},"save-idea":{label:"Save Idea",side:"right",icon:"slot-state state-1",editorModes:[i],draftMode:!0,validStates:[0,1],setState:1,loadOnStateChange:"editor"},"save-pitch":{label:"Save Pitch",side:"right",icon:"slot-state state-5",editorModes:[i],draftMode:!0,validStates:[0,1,5],setState:5,loadOnStateChange:"editor"},"save-draft":{label:"Save Draft",side:"right",icon:"fa fa-floppy-o",editorModes:[i],draftMode:!0,validStates:[null,0,1,5,10,20,30,32,35,40],setState:10,loadOnStateChange:"editor"},"submit-to-editing":{label:"Submit to Editing",side:"right",icon:"slot-state state-30",editorModes:[i],draftMode:!0,validStates:[10,20],setState:30,loadOnStateChange:"post",promptForNotes:!0},"reject-to-writer":{label:"Reject to Writer",side:"left",icon:"slot-state state-20",editorModes:[i],draftMode:!0,validStates:[30,32],setState:20,loadOnStateChange:"cal",promptForNotes:!0},"submit-to-final-review":{label:"Submit to Final Review",side:"right",icon:"slot-state state-32",editorModes:[i],draftMode:!0,validStates:[30],setState:32,loadOnStateChange:"cal",promptForNotes:!0},"reject-to-editor":{label:"Reject to Editor",side:"left",icon:"slot-state state-30",editorModes:[i],draftMode:!0,validStates:[32,35,40],setState:30,loadOnStateChange:"cal",promptForNotes:!0},"submit-for-later":{label:"Done (Don't Schedule)",side:"right",icon:"slot-state state-35",editorModes:[i],draftMode:!0,validStates:[30,32,35,40],editorValidStates:[0,1,5,10,20],setState:35,loadOnStateChange:"cal"},"submit-to-publish":{label:"Done (As Scheduled)",side:"right",icon:"slot-state state-40",editorModes:[i],draftMode:!0,validStates:[30,32,35,40],editorValidStates:[0,1,5,10,20],setState:40,loadOnStateChange:"cal"},"publish-now":{label:"Publish",side:"right",icon:"fa fa-chevron-circle-right",editorModes:[r,i],draftMode:!0,validStates:[null,30,32,35,40],setState:200,loadOnStateChange:"post"},"publish-revisions":{label:"Publish Revisions",side:"right",icon:"fa fa-chevron-circle-right",editorModes:[r,i],draftMode:!1,validStates:[null,200,250],setState:200,loadOnStateChange:"post"}};n.WHTPostEditor=function(s,h){var l={mode:i,postType:null,editDoc:null,calState:null,postTo:"SubmitPost",previewAt:"PreviewPost",defaultHowToHeadlineText:"How to ",defaultHowToHeadlineHtml:'How to <span class="txt-clr-lighter">Type Your Headline (Be Specific)<\/span>',defaultInspHeadlineText:"",defaultInspHeadlineHtml:'<span class="txt-clr-lighter">Type Your Headline (Be Specific)<\/span>',defaultForumHeadlineText:"",defaultForumHeadlineHtml:'<span class="txt-clr-lighter">Ask a Question or Start a Discussion<\/span>',defaultHowToFirstParagraphText:"",defaultHowToFirstParagraphHtml:'<span class="txt-clr-lighter">First, introduce this how-to and who it\'s for. Try to describe the problem your reader is facing and what they\'ll learn from this tutorial.<br/><br/>Then add "Step 1" of your tutorial, embed a how-to video, and/or upload images to illustrate your guide using the toolbar above.<br/>&nbsp;<br/>&nbsp;<\/span>',defaultInspFirstParagraphText:"",defaultInspFirstParagraphHtml:'<span class="txt-clr-lighter">Start with an introduction paragraph describing what\'s newsworthy about this post.<br/><br/>Then upload images and embed videos using the toolbar above.<br/>&nbsp;<br/>&nbsp;<\/span>',defaultForumFirstParagraphText:"",defaultForumFirstParagraphHtml:'<span class="txt-clr-lighter">Start by providing some background on your question, or discussion.<br/><br/>You can upload images, embed videos, or link to something on the web by using the toolbar above.<br/>&nbsp;<br/>&nbsp;<\/span>'};h&&(t.extend(l,h),this._mode=l.mode);var c=this,it=!1,ct=!1,vt=vt++,st=0,rt=1,p=t(s),et=p.find(".share-pre-init"),ot=p.find(".sharePrompt"),pt=p.find(".commentPrompt"),y=p.find(".editorBlocks"),ut=p.find(".share-widget-tips"),yt=t("#sidebar").length>0?parseInt(t("#sidebar").css("margin-top").replace("px","")):0,d=[],a=null,b={},g=[],lt=[],ht=[],nt=[],w=p.find(".cover-image-selector"),ft=w.find(".cover-images"),at=ft.html(),v=null,tt=null,k="0";c.divEditorBlocks=y;this.init=function(){p.on("click.whtPostEditor",".action-buttons button",c._onActionButtonClick);t(window,document).on({"resize.whtPostEditor":function(t){n.isFullScreen()||(tt!=null&&(clearTimeout(tt),tt=null),tt=setTimeout(function(){tt!=null&&(clearTimeout(tt),tt=null);c.onWinResize(t)},10))}});l.editDoc!=null&&n.UrlRegEx.load(this._initEditor,this,[l.editDoc,l.calState]);l.mode!==r||l.editDoc||this._initEditor();c.blinkCursors()};this.blinkCursors=function(){c.blinkInterval&&clearInterval(c.blinkInterval);c._blinkers=p.find("span.cursor.blinker").removeClass("blink");c.blinkInterval=setInterval(function(){c._blinkers.toggleClass("blink")},500)};this.xml=function(t){var f,u,e,h,v,o,i,w;if(arguments.length>0&&t!=null&&typeof t=="object"&&t.version!=null&&t.docParts!=null){for(f=this.getLastBlock(),u=0;f!=null&&f.EB_TYPE!="EBWealthyHeadline"&&u++<1e4;)this.deleteBlock(f,!0),f=this.getLastBlock();u>9998&&console.log("!!! LONG ASS LOOP!!! (whtPostEditor.xml():0)");var b=Number(t.version),k=t.lastCanonicalization!=null?t.lastCanonicalization:null,d=t.autoCapitalizeHeadline!==!1,s=t.docParts,p=this.getFirstBlock();for(p?this.setFocusedBlock(this.getFirstBlock()):a=null,e=0;e<s.length;e++){h=s[e];switch(h.type){case"textBlock":c.attachBlockWithDefaultOptions("EBWealthyParagraph",!0);a.xml(h.htmlText);a.isLastBlock()&&(a.EB_TYPE==="EBWealthyBlockquote"||a.EB_TYPE==="EBWealthyHeadline"||a.EB_TYPE==="EBWealthySubHeadline"||a.EB_TYPE==="EBWealthySubHeadlineStep")&&c.attachBlockWithDefaultOptions("EBWealthyParagraph",!0);break;case"gallery":c.attachBlockWithDefaultOptions("EBGallery",!0);a.xml(h);e+1<=s.length&&(!s[e+1]||s[e+1].type!="textBlock")&&c.attachBlockWithDefaultOptions("EBWealthyParagraph",!0);break;case"attachedLinkBlock":c.attachBlockWithDefaultOptions("EBLink",!0);a.xml(h)}}for(u=0,this.setFocusedBlock(this.getFirstBlock());!a.isLastBlock()&&u++<1e4;)if(f=a,this.setFocusedBlock(f.getNextBlock()),a.isEmpty()){if(a.EB_TYPE=="EBWealthyParagraph"&&(v=this.getNextBlock(a),f.EB_TYPE!="EBWealthyParagraph"&&(v==null||v.EB_TYPE!="EBWealthyParagraph")))continue;this.deleteBlock(a)}return u>9998&&console.log("!!! LONG ASS LOOP!!! (whtPostEditor.xml():1)"),this.setFocusedBlock(this.getFirstBlock()),a.isLastBlock()&&(a.EB_TYPE==="EBWealthyBlockquote"||a.EB_TYPE==="EBWealthyHeadline"||a.EB_TYPE==="EBWealthySubHeadline"||a.EB_TYPE==="EBWealthySubHeadlineStep")&&(c.attachBlockWithDefaultOptions("EBWealthyParagraph",!0),this.setFocusedBlock(this.getFirstBlock())),setTimeout(function(){if(y.find("span.cursor").length>1){y.find("span.cursor").remove();a.setFocused(!1);a=null;c.setFocusedBlock(c.getFirstBlock());try{c.setFocusedBlock(c.getNextBlock(a))}catch(t){}c.setFocusedBlock(c.getFirstBlock())}a.CAN_SET_SELECTION&&a.setSelection(n.EditorBlock.SELECT_START);setTimeout(function(){a.CAN_SET_SELECTION&&a.setSelection(n.EditorBlock.SELECT_END)},10);setTimeout(function(){c.updateStepNumbers()},15)},10),null}if(o='<DocX Version="2.0"',i=this.getFirstBlock(),i!=null){for(l.mode!==r?(w=i.txtElement.val(),o+=' AutoCapitalizeHeadline="{0}"'.format(i.settings.autoCapitalize?"true":"false"),o+=' LastCanonicalization="{0}">'.format(i.settings.lastCanonicalization!=null?i.settings.lastCanonicalization.toISOString():""),i=this.getNextBlock(i)):o+=">",u=0;i!=null&&u++<1e4;)o+=i.xml(),i=this.getNextBlock(i);u>9998&&console.log("!!! LONG ASS LOOP!!! (whtPostEditor.xml():2)")}return o+"<\/DocX>"};this.destroy=function(){window.clearInterval(c.blinkInterval);p.off(".whtPostEditor");t(window).off(".whtPostEditor");for(var n=c.getLastBlock();n!=null;)c.deleteBlock(n,!0)};this.getRoot=function(){return p};this.getMatchedEmbedList=function(){return lt};this.getLoadingEmbedList=function(){return nt};this.getLoadedEmbedList=function(){return ht};this.onShareHowToClick=function(n){n.stopPropagation();c._initEditor.apply(c,[u])};this.onShareInspirationClick=function(n){n.stopPropagation();c._initEditor.apply(c,[f])};this.onShareForumClick=function(n){n.stopPropagation();c._initEditor.apply(c,[e])};this.onCoverImageToggleLeft=function(){c.onCoverImageToggle(-1)};this.onCoverImageToggleRight=function(){c.onCoverImageToggle(1)};this.onCoverImageToggle=function(i){var r=ft.find("div"),e,u,f;if(r.length<2){w.find("button.mfr, button.mfl").hide();return}for(e=0;e<r.length;e++)if(u=t(r[e]),u.hasClass("active")){u.toggleClass("active",!1);f=e+i;f<0?f=r.length-1:f>=r.length&&(f=0);u=t(r[f]);u.toggleClass("active",!0);k=n.ImgUrl.toImgID(u.find("img").attr("src"));break}};this.onUploadCoverImageClick=function(){n.Images.showUploadPrompt({uploadType:"GalleryImage",uploadToID:null,crop:!0,cropAspectRatio:640/300,minSize:[640,300],minSizeToCrop:[640,300],onResponse:function(n,t){c.onUploadCoverImageResponse(n,t.uploadID)}});return};this.onUploadCoverImageResponse=function(t){if(n.NavBar.close(),t.Error!=null){n.Alerts.DisplayErrorNotification(t.Error.ErrorText);return}if(t=t.Response.Value,t.OriginalWidth<640||t.OriginalHeight<300){n.Alerts.DisplayErrorNotification("The image you selected was not big enough. It must be a minimum of 640x300.");return}var i=new n.ImgUrl(t.ImageID);g.push(i);k=t.ImageID;c._renderCoverImageSelector(t.ImageID);c.execDefaultSaveAction(!0)};this.onFocusPreviousBlock=function(n){c.setFocusedBlock(c.getPrevBlock(n.fromBlock))};this.onFocusThisBlock=function(n){c.setFocusedBlock(n.fromBlock)};this.onFocusNextBlock=function(n){c.setFocusedBlock(c.getNextBlock(n.fromBlock))};this.onFocusFollowingBlock=function(){};this.onDeleteBlock=function(n){c.deleteBlock(n.fromBlock)};this.onUpdateDefaultTip=function(n){c.__iIsShowingDefaultTipForBlockID==n.fromBlock.blockID&&c._showSidebarTip(n.fromBlock.defaultSidebarTip,!0,!0)};this.onWinResize=function(n){y.find(".editorBlock").each(function(){c.getBlockByBlockID(t(this).data("blockID")).onWinResize(n)})};this._preSaveValidate=function(t){try{var u="",i="",f=c.getFirstBlock();return l.mode!==r&&(f==null?i="Your post is still empty.":(u=f.wte.getValue(!0),u==""?i="Please enter a headline":u.length>120&&(i="Your headline is too long. Keep it under 120 characters.",f.wte.setSelection(n.EditorBlock.SELECT_ALL)))),t=='<DocX Version="2.0"><\/DocX>'&&(i="Your post is still empty!"),t.indexOf("earlylook.cc")>-1&&n.Alerts.DisplayErrorNotification("WARNING: earlylook.cc is mentioned in this post. Please don't publish before fixing."),i}catch(e){return console.log(e),"Exception When Checking for Errors!"}};this.submitPost=function(u,f,e){var h,b,a,y,w,o;if(!c._isSubmitting&&(h=u.setState!==200,b="",h||l.mode===r||e!==!0)){if(c._isSubmitting=!0,n.ToggleProgressCursor(!0),a=c.getLastBlock(),a&&a.wte&&a.wte.cleanup(),y=c.xml(),w=c._preSaveValidate(y),w!=""){c._isSubmitting=!1;n.ToggleProgressCursor(!1);e!==!0?n.Alerts.DisplayErrorNotification(w):console.log(w);return}l.mode!==r&&(b=c.getFirstBlock().wte.getValue(!0));try{l.mode===i?(o=-1,u.setState!=null?(o=u.setState,o===200&&(o=40,h=!1),o===10&&l.calState&&l.calState.state>10&&(o=l.calState.state)):l.calState&&(o=l.calState.state),t.post(n.BuildAJAXUrl(l.postTo),{ArticleID:l.editDoc&&l.editDoc.articleID?l.editDoc.articleID:0,RevisionID:l.editDoc&&l.editDoc.revisionID?l.editDoc.revisionID:0,CoverImageID:k||"0",SaveDraft:h===!0,Headline:b,ArticleType:l.postType,XmlContent:y,WorldTopicID:p.data("world-topic-id")?p.data("world-topic-id"):0,State:l.calState?o:-1,UtcOffsetMinutes:(new Date).getTimezoneOffset()},function(i){var f,r;if(console.dir(i),i.Error==null&&i.Response.Value.Success){c._isSubmitting=!1;n.ToggleProgressCursor(!1);i.Response.Value.calState&&(l.calState||(l.calState={}),f=l.calState.state!==i.Response.Value.calState.state,t.extend(!0,l.calState,i.Response.Value.calState),i.Response.Value.calState=null,delete i.Response.Value.calState);l.editDoc||(l.editDoc={});t.extend(!0,l.editDoc,i.Response.Value);switch(u.loadOnStateChange){case"cal":window.onbeforeunload=null;n.ToggleProgressCursor(!0);n.NavigateTo("/cal/");break;case"post":window.onbeforeunload=null;n.ToggleProgressCursor(!0);n.NavigateTo(i.Response.Value.ArticleUrl);break;case"editor":default:r=i.Response.Value.ArticleUrl+"edit/";String(window.location)!=r&&(window.onbeforeunload=null,n.ToggleProgressCursor(!0),n.NavigateTo(r));e!==!0&&n.Alerts.Show("Saved Changes",!0);c._initActionButtons();v!=null&&v.window&&v.window.location&&v.WHT&&c.preview()}}else c._isSubmitting=!1,n.ToggleProgressCursor(!1),e!==!0?n.Alerts.DisplayErrorNotification(i.Error.ErrorText):console.log(i.Error.ErrorText)}).error(function(){e!==!0?n.Alerts.DisplayErrorNotification("There was an unexpected error saving your post."):console.log("There was an unexpected error saving your post.");c._isSubmitting=!1;n.ToggleProgressCursor(!1)})):l.mode===r&&(n.Comments.submitComment({editorRoot:s,xml:y,parentID:Number(s.closest(".user-comment-editor").data("reply-to-parent")||0),commentID:l.editDoc&&l.editDoc.commentID?l.editDoc.commentID:0})&&c._resetEditor(!0),c._isSubmitting=!1,n.ToggleProgressCursor(!1))}catch(d){t.error("Exception When Trying to Submit!");console.dir(d);console.log(d);c._isSubmitting=!1;n.ToggleProgressCursor(!1)}}};this._onToolboxClick=function(n){switch(n){case"bold":case"italic":case"link":case"list-ol":case"list-ul":if(a&&(a.EB_TYPE==="EBWealthyParagraph"||a.EB_TYPE==="EBWealthyBlockquote"))a.onToggleFormatting(n);break;case"step":c.attachBlockWithDefaultOptions("EBWealthySubHeadlineStep");break;case"headline":c.attachBlockWithDefaultOptions("EBWealthySubHeadline");break;case"quote":c.attachBlockWithDefaultOptions("EBWealthyBlockquote");break;case"image":c.attachBlockWithDefaultOptions("EBGalleryImage");break;case"video":c.attachBlockWithDefaultOptions("EBGalleryVideo");break;case"gallery-template-index-0":case"gallery-template-index-1":case"gallery-template-index-2":case"gallery-template-index-3":case"gallery-template-index-4":case"gallery-template-index-5":a&&a.EB_TYPE==="EBGallery"&&a.setDisplayTemplate(Number(n.substr(23,1)));break;case"code":c.attachBlockWithDefaultOptions("EBCodeEditor");break;default:console.log("!!! Unimplemented toolbox button action: "+n)}};this.onMouseDown=function(){t(window).on({"mouseup.whtPostEditor":c.onMouseUp})};this.onMouseUp=function(){t(window).off("mouseup.whtPostEditor")};this._initEditor=function(u){var f,e,h,o;if(n.clearRedirect(),it&&this._resetEditor(!0),window.onbeforeunload=function(){return"If you leave this page now, any unsaved changes will be lost!"},f=typeof u=="object"?u:null,f&&(u=f.postType),l.postType=u,e=this._getDefaultPlaceholderStrings(u),l.mode===i){t("#sidebar").length>0&&t("#sidebar").animate({marginTop:0});et.hide();ot.show();t(".share-widget").toggleClass("active",!0);h=c._attachEditorBlock("EBWealthyHeadline",{defaultText:e.headlineText,defaultHtml:e.headlineHtml,xml:f?f.headline:null,autoCapitalize:f?f.docX.autoCapitalizeHeadline!==!1:!0,lastCanonicalization:f?f.docX.lastCanonicalization!=null?f.docX.lastCanonicalization:null:null,followWithBlockOptions:{defaultText:e.firstParagraphText,defaultHtml:e.firstParagraphHtml,attachToolbox:!0}});h.CAN_SET_SELECTION&&h.setSelection(n.EditorBlock.SELECT_END);f&&c.xml(f.docX);k=f?f.coverImageID:"0";c._renderCoverImageSelector(k);w.on("click.whtPostEditor",".cover-image-buttons button.align-center",c.onUploadCoverImageClick);w.on("click.whtPostEditor",".cover-image-buttons button.mfr",c.onCoverImageToggleRight);w.on("click.whtPostEditor",".cover-image-buttons button.mfl",c.onCoverImageToggleLeft);t(document).on("keydown",function(n){var t;switch(n.keyCode||n.which){case 83:if(!(n.ctrlKey||n.metaKey)||n.altKey||!c.isInited()||l.mode!==i)break;return c.execDefaultSaveAction(),!1;case 80:if(!(n.ctrlKey||n.metaKey)||n.altKey||!c.isInited()||l.mode!==i)break;return c.preview(),!1;case 85:if(!(n.ctrlKey||n.metaKey)||n.altKey||!c.isInited())break;return(t=c.getFocusedBlock(),t!=null&&t.EB_TYPE!="EBWealthyParagraph"&&t.EB_TYPE!="EBGallery")?!1:(c.attachBlockWithDefaultOptions("EBGalleryImage"),!1);case 69:if(!(n.ctrlKey||n.metaKey)||n.altKey||!c.isInited())break;return(t=c.getFocusedBlock(),t!=null&&t.EB_TYPE!="EBWealthyParagraph"&&t.EB_TYPE!="EBGallery")?!1:(c.attachBlockWithDefaultOptions("EBGalleryVideo"),!1)}})}else l.mode===r&&(et.hide(),ot.show(),s.parent().toggleClass("active",!0),s.toggleClass("active",!0),s.find(".comment-input").hide(),f||(o=c._attachEditorBlock("EBWealthyParagraph",{defaultHtml:"",attachToolbox:!0}),l.editDoc=null,window.setTimeout(function(){c.setFocusedBlock(o);o.CAN_SET_SELECTION&&o.setSelection(n.EditorBlock.SELECT_END)},1)),f&&(l.editDoc=f,c.xml(f)));c._initActionButtons();n.UrlRegEx.load();it=!0};this.execDefaultSaveAction=function(n){var e,i;if(c.isInited()){var r=null,u=null,f=!1;l.editDoc.articleID&&l.editDoc.articleID!=0&&l.editDoc.articleID!=-1?(l.calState&&(u=l.calState.state),f=l.editDoc.isPublished):l.calState&&(u=l.calState.state);for(e in o)if(i=o[e],i.action=e,f!=i.draftMode&&i.draftMode!=null&&t.inArray(u,i.validStates)>-1){r=i;break}r&&(f===!1||n!==!0)&&c.submitPost(r,n===!0?"Auto-Save":"",n===!0)}};this._initActionButtons=function(){var h={left:[],right:[]},f=null,y=!1,a,u,v,p,c,e;l.mode===i?l.editDoc.articleID&&l.editDoc.articleID!=0&&l.editDoc.articleID!=-1?(l.calState&&(f=l.calState.state),y=l.editDoc.isPublished):l.calState&&(f=l.calState.state):l.mode===r;for(a in o)u=o[a],u.action=a,y!=u.draftMode&&t.inArray(l.mode,u.editorModes)>-1&&(t.inArray(f,u.validStates)>-1||n.loggedInUser.cd===1337&&u.editorValidStates!=null&&t.inArray(f,u.editorValidStates)>-1)&&h[u.side].push(u);for(h.right.reverse(),v=h.right.concat(h.left),p=s.find(".action-buttons").empty(),c=0;c<v.length;c++)e=v[c],p.append(t.format('<button type="button" class="raised-btn {0}" data-action="{1}"><i class="{3}"><\/i>{2}<\/button>',e.side==="left"?"mfl":"mfr",e.action,e.setState===10&&f!=null&&f>10?"Save":e.label,e.icon))};this._onActionButtonClick=function(n){var i=t(n.target),r,u;i.is("button")||(i=i.closest("button"));r=i.data("action");u=o[r];u.action=r;n.stopPropagation();c._executeAction(u)};this._executeAction=function(n,t){if(n==null){console.log("invalid action: "+action);return}if(!c._isSubmitting){n.promptForNotes&&t==null;switch(n.action){case"cancel-edit":c.cancelEdits();return;case"preview":c.preview();return;default:c.submitPost(n,t);return}}};this.cancelEdits=function(t){var u=c._resetEditor.apply(c,[t]);u&&(window.onbeforeunload=null,l.mode==i?l.editDoc&&l.editDoc.cancelUrl&&l.editDoc.cancelUrl!=""&&(c._isSubmitting=!0,n.ToggleProgressCursor(!0),ot.hide(),et.html("<h2>Canceling...<\/h2>").show(),n.NavigateTo(l.editDoc.cancelUrl)):l.mode==r&&(s.find(".action-buttons").empty(),n.Comments.resetEditor()))};this.preview=function(){var i;if(!c._isSubmitting){c._isSubmitting=!0;n.ToggleProgressCursor(!0);i=c.getLastBlock();i&&i.wte&&i.wte.cleanup();var u=c.xml(),f="",e=c._preSaveValidate(u);if(e!=""){c._isSubmitting=!1;n.ToggleProgressCursor(!1);n.Alerts.DisplayErrorNotification(e);return}l.mode!==r&&(f=c.getFirstBlock().wte.getValue(!0));t.post(n.BuildAJAXUrl(l.previewAt),{Headline:f,ArticleType:l.postType,CoverImageID:k||"0",XmlContent:u},function(i,r,u){var e;if(c._isSubmitting=!1,n.ToggleProgressCursor(!1),i.Error==null&&i.Response.Value.Success){if(u.getResponseHeader("X-Abandoned")=="1"){setTimeout(function(){c.preview()},10);return}if(v!=null&&v.window&&v.window.location&&v.WHT){e=t(v.window).scrollTop();v.WHT.NavigateTo.apply(v,["/preview/",!0]);var f=null,s=0,o=function(){if(f!=null&&(clearTimeout(f),f=null),v!=null&&v.window&&v.window.location&&v.WHT)if(v.window.scroll(0,e),t(v.window).scrollTop()!=e){if(s++>100)return}else return;f=setTimeout(o,10)};f=setTimeout(o,50)}else v=window.open("/preview/","articlepreview","location=yes,resizable=yes,scrollbars=yes,dependent=yes");v==null?n.Alerts.DisplayErrorNotification("Please Disable Your Pop-Up Blocker to View Previews"):v.focus()}else n.Alerts.DisplayErrorNotification(i.Error.ErrorText)}).error(function(){console.log("There was an error creating the preview.");c._isSubmitting=!1;n.ToggleProgressCursor(!1)})}};this._initLinkLoader=function(n){function r(i){var r=t.trim(i.text());t.inArray(r,nt)>-1&&i.css({color:n.css("color")})}for(var i=0;i<nt.length;i++)t.inArray(nt[i],ht)>-1&&nt.remove(i);if(nt.length<1){n.remove();return}n.animate({color:"#6CD49A"},{step:function(){y.find(".markDownURL").each(function(){r(t(this))})},duration:500,complete:function(){n.animate({color:"#056D33"},{duration:500,step:function(){y.find(".markDownURL").each(function(){r(t(this))})},complete:function(){c._initLinkLoader(n)}})}})};this._getAvailableCoverImages=function(){for(var r,e,u,t,i=[],o=c.getGalleryBlocks(),f=0;f<o.length;f++)if(r=o[f],r.gal&&r.gal.settings&&r.gal.settings.galleryItems)for(e=r.gal.settings.galleryItems,u=0;u<e.length;u++)t=e[u],t.galleryItemType==="Image"?t.oImgUrl&&t.oImgUrl.imgID&&t.width>=640&&t.height>=300&&i.push(t.oImgUrl):t.galleryItemType==="Video"&&t.thumbSource&&i.push(new n.ImgUrl(t.thumbSource));return g&&g.length>0&&(i=g.concat(i)),i};this._renderCoverImageSelector=function(i){var u,s,o,f,a;if(l.mode!=r){if(w.show(),u=c._getAvailableCoverImages(),(typeof i=="undefined"||i==="0")&&(i=k!=="0"?k:"0"),i=i!=="0"?n.ImgUrl.toImgID(i):"0",k=i,(!u||u.length<1)&&i!=="0"&&(s=new n.ImgUrl(i),g=[s],u=[s]),u&&u.length>0){var v='<div class="cover-img-{0}{2}" data-image-id="{0}"><img width="1280" height="600" src="{1}" /><\/div>',e="",h=!1;for(o=0;o<u.length;o++)(f=typeof u[o]=="object"?u[o]:new n.ImgUrl(u[o]),f.imgID)&&(u[o]=f,i==f.imgID&&(h=!0),e+=t.format(v,f.imgID,f.toString("1280x600"),i==f.imgID?" active":""));i&&i!=="0"&&!h?(f=new n.ImgUrl(i),g.push(f),u.push(f),e=t.format(v,f.imgID,f.toString("1280x600")," active")+e):h||(a=e.indexOf("class")+2,e=e.substring(0,a+1)+"active "+e.substring(a));ft.html(e);w.toggleClass("no-image",!1)}else ft.html(at),w.toggleClass("no-image",!0);u.length>1?w.find("button.mfr, button.mfl").show():w.find("button.mfr, button.mfl").hide()}};this._getDefaultPlaceholderStrings=function(n){return{headlineText:n==u?l.defaultHowToHeadlineText:n==f?l.defaultInspHeadlineText:n==e?l.defaultForumHeadlineText:null,headlineHtml:n==u?l.defaultHowToHeadlineHtml:n==f?l.defaultInspHeadlineHtml:n==e?l.defaultForumHeadlineHtml:null,firstParagraphText:n==u?l.defaultHowToFirstParagraphText:n==f?l.defaultInspFirstParagraphText:n==e?l.defaultForumFirstParagraphText:null,firstParagraphHtml:n==u?l.defaultHowToFirstParagraphHtml:n==f?l.defaultInspFirstParagraphHtml:n==e?l.defaultForumFirstParagraphHtml:null}};this._resetEditor=function(u){var h=c.xml(),f=c.getFirstBlock(),o,e;return f!=null&&f.wte&&(o=f.wte.getValue(!0),u!==!0&&(h!='<DocX Version="2.0"><\/DocX>'||o!="")&&!confirm("Are you sure? Your changes will be lost."))?!1:(l.postType=null,c._clearEditor(),l.mode===i?(e=t("#sidebar"),e.length>0&&e.animate({marginTop:yt})):l.mode==r&&(l.editDoc&&l.editDoc.commentID&&t("#comment-"+l.editDoc.commentID).show(),n.Comments.resetEditor(),s.removeClass("active"),s.parent().removeClass("active")),nt=[],lt=[],ht=[],it=!1,window.onbeforeunload=null,!0)};this._clearEditor=function(){var n,i,r;c.__iIsShowingDefaultTipForBlockID=null;for(n in b)if(b[n]!=null)try{clearTimeout(b[n]);b[n]=null}catch(u){}for(b={},ut.empty(),i=this.getLastBlock(),r=0;i!=null&&r++<1e4;)this.deleteBlock(i,!0),i=this.getLastBlock();r>9998&&console.log("!!! LONG ASS LOOP!!! (whtPostEditor._resetEditor():0)");a=null;st=0;rt=1;t(".share-widget").toggleClass("active",!1);g=[];k="0";ft.html(at);w.toggleClass("no-image",!0).hide().find("button.mfr, button.mfl").hide();ot.css("display","none");et.show()};this._showSidebarTip=function(n,t,i){var u,f,r;n!=null&&n.sHeadline!==""&&n.sBodyTemplate!==""&&(u='<div class="share-tip rnd-big-top"><div class="share-tip-header rnd-big-top"><span class="ribbon"><\/span>{0}<\/div><div class="share-tip-body">{1}<\/div><\/div>',f=[typeof n.sHeadline=="function"?n.sHeadline():n.sHeadline,typeof n.sBodyTemplate=="function"?n.sBodyTemplate():n.sBodyTemplate],i!==!0&&this._hideSidebarTip(n,!1,t)||(r=ut.empty().html(u.replace(/\{(\d+)\}/g,function(n,t){return f[t]})).find(".share-tip").fadeIn("fast").css("margin-top",n.oForBlock.baseElement.position().top+6+"px"),n.iHideAfterSeconds!=null&&n.iHideAfterSeconds>0&&(b["tip"+st]=setTimeout(function(){c._hideSidebarTip()},n.iHideAfterSeconds*1e3)),r.data("tipID",st++),n.bindEvents&&n.bindEvents(r),c.__iIsShowingDefaultTipForBlockID=t==!0?n.oForBlock.blockID:null))};this._hideSidebarTip=function(n,t,i){var u=ut.find(".share-tip"),r;return u.length>0?(r=u.data("tipID"),b["tip"+r]!=null&&(clearTimeout(b["tip"+r]),b["tip"+r]=null,delete b["tip"+r]),c.__iIsShowingDefaultTipForBlockID=null,u.fadeOut("fast",function(){ut.empty();n!=null?c._showSidebarTip(n,i):t||c._showDefaultSidebarTip()}),!0):(n!=null||t||c._showDefaultSidebarTip(),!1)};this._showDefaultSidebarTip=function(){if(c.__showDefaultTipTO!=null&&(clearTimeout(c.__showDefaultTipTO),c.__showDefaultTipTO=null),arguments.length==0){c.__showDefaultTipTO=setTimeout(function(){c._showDefaultSidebarTip(!0)},50);return}var n=ut.find(".share-tip").length>0;if((!n||c.__iIsShowingDefaultTipForBlockID!=null)&&a!=null){if(n&&c.__iIsShowingDefaultTipForBlockID==a.blockID)return;a.defaultSidebarTip!=null?this._showSidebarTip(a.defaultSidebarTip,!0,arguments.length>=2):c.__iIsShowingDefaultTipForBlockID!=null&&this._hideSidebarTip(null,!0)}};this.attachBlockWithDefaultOptions=function(t,i,r,u){var f={},o='<span class="txt-clr-lighter">Click to start a new paragraph...<\/span>',v='<span class="txt-clr-lighter">Click to start typing your detailed instructions for this step...<\/span>',y=a!=null&&a.CAN_BE_SPLIT&&it,s=y?n.EditorBlock.AM_SPLIT:null,e,h;switch(t){case"EBLink":if(a==null||a.onMenuButtonClick("EBLink",f))return c._attachEditorBlock("EBLink",f,null,i);break;case"EBGallery":if(f=typeof u=="object"?u:{initMode:"",followWithBlockOptions:{defaultText:"",defaultHtml:o}},a==null||a.onMenuButtonClick("EBGallery",f))return c._attachEditorBlock("EBGallery",f,s,i);break;case"EBGalleryVideo":if(f=typeof u=="object"?u:{initMode:"video",followWithBlockOptions:{defaultText:"",defaultHtml:o}},a==null||a.onMenuButtonClick("EBGallery",f))return c._attachEditorBlock("EBGallery",f,s,i);break;case"EBGalleryImage":if(f=typeof u=="object"?u:{initMode:"image",followWithBlockOptions:{defaultText:"",defaultHtml:o}},a==null||a.onMenuButtonClick("EBGallery",f))return c._attachEditorBlock("EBGallery",f,s,i);break;case"EBWealthySubHeadline":if(f={isStep:!1,autoCapitalize:!0,followWithBlockOptions:{defaultText:"",defaultHtml:o}},a==null||a.onMenuButtonClick("EBWealthySubHeadline",f))return e=c._attachEditorBlock("EBWealthySubHeadline",f,s,i),e.setSelection(n.EditorBlock.SELECT_END),e;break;case"EBWealthySubHeadlineStep":if(f={isStep:!0,stepNum:rt,autoCapitalize:!0,followWithBlockOptions:{defaultText:"",defaultHtml:v}},a==null||a.onMenuButtonClick("EBWealthySubHeadline",f))return e=c._attachEditorBlock("EBWealthySubHeadline",f,s,i),e.setSelection(n.EditorBlock.SELECT_END),e;break;case"EBWealthyBlockquote":if(f=typeof u=="object"?u:{followWithBlockOptions:{defaultText:"",defaultHtml:o}},a==null||a.onMenuButtonClick("EBWealthyBlockquote",f))return e=c._attachEditorBlock("EBWealthyBlockquote",f,s,i),e.setSelection(n.EditorBlock.SELECT_END),e;break;case"EBWealthyParagraph":return a==null||a.EB_TYPE=="EBWealthyHeadline"?(h=this._getDefaultPlaceholderStrings(l.postType),f={defaultText:h.firstParagraphText,defaultHtml:h.firstParagraphHtml,attachToolbox:!0}):f=a.EB_TYPE=="EBWealthySubHeadline"&&a.settings.isStep?{defaultText:"",defaultHtml:v}:{defaultText:"",defaultHtml:o},c._attachEditorBlock("EBWealthyParagraph",f,null,i,r);case"EBCodeEditor":if(f={followWithBlockOptions:{defaultText:"",defaultHtml:o}},a==null||a.onMenuButtonClick("EBCodeEditor",f))return c._attachEditorBlock("EBCodeEditor",f,null,i)}return null};this._attachEditorBlock=function(t,i,r,u,f){var h=window.pageYOffset||document.documentElement.scrollTop,e,o,s;if(n.EditorBlock.BlockTypes[t]==null)return console.log("Invalid BlockType. Is a Plugin Missing? ["+t+"]"),null;d.push(new n.EditorBlock.BlockTypes[t](c,i));e=d[d.length-1];o=a;i&&i.insertAfterBlock&&(o=i.insertAfterBlock);switch(r==null?e.ATTACHMENT_MODE:r){case n.EditorBlock.AM_SPLIT:o!=null&&o.CAN_BE_SPLIT&&e.CAN_SPLIT_BLOCKS&&e.splittingOtherBlock(o)!==!1&&o.split(e);case n.EditorBlock.AM_APPEND_NEXT:if(o!=null){e.EB_TYPE=="EBWealthyParagraph"||o.EB_TYPE=="EBWealthyParagraph"||o.CAN_HAVE_TWIN_NEIGHBOR||o.CAN_MERGE_WITH_TWIN?o.baseElement.after(e.baseElement):(s=o.getNextBlock(),s!=null&&s.ATTACHMENT_MODE!=n.EditorBlock.AM_APPEND_BOTTOM?((s.blockID==e.blockID||s.ATTACHMENT_MODE==n.EditorBlock.AM_APPEND_BOTTOM)&&(s=c.attachBlockWithDefaultOptions("EBWealthyParagraph",!0,!0),s==null&&(s=o)),s.baseElement.after(e.baseElement)):o.baseElement.after(e.baseElement));break}case n.EditorBlock.AM_APPEND_BOTTOM:y.append(e.baseElement)}e.baseElement.on({"focusPreviousBlock.whtPostEditor":c.onFocusPreviousBlock,"focusNextBlock.whtPostEditor":c.onFocusNextBlock,"updateDefaultTip.whtPostEditor":c.onUpdateDefaultTip});return f!==!0&&(this.setFocusedBlock(e),u!==!0&&e.FOLLOW_WITH_BLOCK_TYPE!=null&&e.FOLLOW_WITH_BLOCK_TYPE!=""&&n.EditorBlock.BlockTypes[e.FOLLOW_WITH_BLOCK_TYPE]!=null&&(e.isLastBlock()||e.getNextBlock().EB_TYPE!=e.FOLLOW_WITH_BLOCK_TYPE)&&(this._attachEditorBlock(e.FOLLOW_WITH_BLOCK_TYPE,e.settings.followWithBlockOptions,n.EditorBlock.AM_APPEND_NEXT,!0,!0),this.setFocusedBlock(e))),window.scrollTo(window.pageXOffset||document.documentElement.scrollLeft,h),e.initDroppable(),e.initToolbox(),this.updateStepNumbers(),e};this.setFocusedBlock=function(n){var i,r;if(n!=null){if(a!=null){if(a.blockID==n.blockID)return;i=["EBWealthyParagraph","EBWealthyBlockquote","EBWealthyHeadline","EBWealthySubHeadline","EBCodeEditor"];~t.inArray(a.EB_TYPE,i)&&!~t.inArray(n.EB_TYPE,i)&&(r=t('<textarea id="dummyTextArea'+n.blockID+'" style="width:1px;height:1px;position:fixed;left:50px;top:100px;"><\/textarea>').appendTo("body"),r.focus(),r.remove());a.setFocused(!1);c._showDefaultSidebarTip()}a=n;a.setFocused(!0);c.updateStepNumbers()}};this.getFocusedBlock=function(){return a};this.getBlockByBlockID=function(n){for(var t=0;t<d.length;t++)if(d[t].blockID==n)return d[t];return null};this.getFirstBlock=function(){var n=y.find(".editorBlock");return n.length>0?this.getBlockByBlockID(t(n[0]).data("blockID")):null};this.getPrevBlock=function(n){for(var r=y.find(".editorBlock"),u=null,i=0;i<r.length;i++){if(t(r[i]).data("blockID")==n.blockID)break;u=t(r[i]).data("blockID")}return u==null?null:this.getBlockByBlockID(u)};this.getNextBlock=function(n){for(var r=y.find(".editorBlock"),u=!1,i=0;i<r.length;i++){if(u)return this.getBlockByBlockID(t(r[i]).data("blockID"));u=t(r[i]).data("blockID")==n.blockID}return null};this.getLastBlock=function(){var n=y.find(".editorBlock");return n.length>0?this.getBlockByBlockID(t(n[n.length-1]).data("blockID")):null};this.getGalleryBlocks=function(){for(var i,r=y.find(".editorBlock"),u=[],n=0;n<r.length;n++)i=this.getBlockByBlockID(t(r[n]).data("blockID")),i.EB_TYPE=="EBGallery"&&u.push(i);return u};this.isInited=function(){return it};this.isDragging=function(n){return typeof n!="undefined"&&(ct=!!n),ct};this.getSettings=function(){return l};this.deleteBlock=function(t,i){var r,u;if(t!=null&&(r=this.getPrevBlock(t),i===!0||r!=null&&r.blockID!=t.blockID)){for(r!=null&&(this.setFocusedBlock(r),r.IS_TEXT&&r.setSelection(n.EditorBlock.SELECT_END)),u=0;u<d.length;u++)if(d[u].blockID==t.blockID){d.splice(u,1);break}t.destroy();t=null;this.updateStepNumbers();this.mergeNeighboringBlock(r)}};this.mergeNeighboringBlock=function(t){if(t!=null&&!t.CAN_HAVE_TWIN_NEIGHBOR){var i=t.IS_TEXT?t.getSelectionRange():null,r=i?i.end==0?t.wte.getValue().length+1:i.end+1:n.EditorBlock.SELECT_END,u=this.getNextBlock(t),f=t.merge(u);f&&t.IS_TEXT&&t.setSelection(r)}};this.updateStepNumbers=function(n){for(var i,e,f=y.find(".editorBlock"),r=1,u=0;u<f.length;u++)i=this.getBlockByBlockID(t(f[u]).data("blockID")),i.EB_TYPE=="EBWealthySubHeadline"&&i.settings.isStep==!0?(e=i.wte.getValue().toLowerCase(),(r>2&&e.indexOf("step 1:")==0||e=="step 1")&&(r=1),i.setStepNum(r++)):i.EB_TYPE!="EBWealthyParagraph"||i.minimumHeights==null||i.baseElement==null||n||(i.displayElement.css("min-height",String(i.minimumHeights[u==f.length-1?1:0])+"px"),i.txtElement.height(i.displayElement.height())),a!=null&&i.blockID==a.blockID&&(rt=r);a==null&&(rt=r);t('.editor-toolbox button[data-action="step"]').html("Step "+String(rt))}};t.fn.whtPostEditor=function(i){return this.each(function(){var r=t(this),u;if(r.data("whtPostEditor"))return r.data("whtPostEditor");u=new n.WHTPostEditor(r,i);r.data("whtPostEditor",u);u.init()})}})(window.WHT=window.WHT||{},jQuery),function(n,t){n.WealthyTextEditor=function(i,r){function ut(r,f){try{var e=u.baseEditor||i.parents(".share-widget").data("whtPostEditor"),h=e.getMatchedEmbedList(),s=e.getLoadingEmbedList(),c=e.getLoadedEmbedList(),o=f.match(d)?!0:!1,l=o?{VideoURL:r}:{UploadKey:f};h.push(r);t.post(o?n.BuildAJAXUrl("GetVideoEmbed"):n.BuildAJAXUrl("UploadPreviewImage"),l,function(n){var c,i,f,l,h;if(n&&n.Error==null){if(!e.isInited())return;var s=u.getValue(),a=s.indexOf(r),v=new RegExp("^\\[+"+r.replace("?","\\?").replace("(","\\(").replace(")","\\)")+"\\s*\\]+\\s*$","gmi"),t=v.exec(s);if(~a&&t&&~t.index)console.log("found empty:",t),u.setSelection(t.index,t.index+t[0].length,!0);else if(c=new RegExp("\\[+"+r.replace("?","\\?").replace("(","\\(").replace(")","\\)")+"\\s*(.*)\\]+\\s*","gmi"),i=c.exec(s),console.log("found with text:",i),i&&~i.index&&i[1]&&i[1].length>1)return;if(f=n.Response.Value,l=e.getFocusedBlock(),o&&typeof f.embedTag!="undefined"&&f.embedTag.length>0&&f.thumbSource.length>0||!o&&f.ImageWidth>=300&&f.ImageHeight>=48)if(h=e.attachBlockWithDefaultOptions("EBGallery",!1,!0,{insertAfterBlock:l,initMode:""}),o)h.gal.onVideoEmbedResponse(n);else h.gal.onImageUploadResponse(n)}}).always(function(){c.push(r);for(var n=0;n<s.length;n++)s[n]===r&&s.remove(n)})}catch(a){return console.log("Error Occurred:",a),!1}return!0}function ft(n,t,i){var r="["+n+" ]",u=i.substring(0,t),f=i.substring(t+n.length);return u+r+f}var s,o;this.settings={defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Click to start typing...<\/span>',defaultCharIndex:0,multiLine:!0,maxLength:0,text:"",html:""};r&&t.extend(!0,this.settings,r);var u=this,nt=nt++,k=/\[?(?:(?:https?|ftp|itpc):\/\/|www\.|ftp\.)(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#\/%=~_|$?!:,.])*(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[A-Z0-9+&@#\/%=~_|$])\]?/gi,d=/\b(?:(?:https?|ftp|itpc):\/\/|www\.|ftp\.)\S*(about\.com|youtube\.com|youtu\.be|metacafe\.com|instagr(am\.com|\.am)\/p\/|facebook\.com\/[a-z0-9\.]+\/videos\/[0-9]+\/|vtutorial\.com|dailymotion\.com|revver\.com|howcast\.com|vimeo\.com(?!\.))\S*/gi,tt=/(^https?:\/\/(?:[a-z\-]+\.)+[a-z]{2,6}(?:\/[^\/#?]+)+\.(?:jpe?g|gif|png)$|^(http(s)?:\/\/)?((www|i)\.)?giphy\.com\/([a-z0-9_-]+\/)*([a-z0-9_-]+\-)*([a-z0-9]+)(\.gif|\/|)($|\?(.*)$))/i,it=/^(?:(?:https?|ftp|itpc):\/\/)/i,f=t(i).val(u.settings.defaultText),y=f.wrap('<div class="wteTextInnerWrap"/>').parent(".wteTextInnerWrap"),l=y.wrap('<div class="wteTextWrap"/>').parent(".wteTextWrap"),p=l.wrap('<div class="wteWrapper"/>').parent(".wteWrapper"),c=p.append('<div class="wteDispWrap"><div class="wteDispInnerWrap"><span class="wteDisplay">'+u.settings.defaultHtml+"<\/span><\/div><\/div>").find(".wteDisplay"),h=p.find(".wteDispWrap"),g=h.find(".wteDispInnerWrap"),e={},a=!1,v=!1,rt=jQuery.browser.msie||jQuery.browser.opera||navigator.userAgent.match(/(ip(ad|hone|od))|(\sEdge\/[1-9][0-9])/i)!=null,w=navigator.userAgent.match(/ip(ad|hone|od)/i)!=null&&navigator.userAgent.indexOf("windows phone")===-1,b=0;this.init=function(){b=t(window).width();this.copyStyles();f.on({"paste.wealthyTextArea":u.onTxtPaste,"mousedown.wealthyTextArea":u.onMouseDown,"focus.wealthyTextArea":u.onTxtFocus,"blur.wealthyTextArea":u.onTxtBlur,"keydown.wealthyTextArea":u.onTxtKeyDown,"keyup.wealthyTextArea":u.onTxtKeyUp,"change.wealthyTextArea":u.onTxtChange,"input.wealthyTextArea":u.onTxtInput,"scroll.wealthyTextArea":function(){f.scrollTop(0)}});c.on({"mousedown.wealthyTextArea":u.onMouseDown});u.settings.defaultText&&u.selectEnd()};this.copyStyles=function(){f.removeAttr("style");t.each("padding-top,padding-bottom,font-family,font-size,font-weight,font-style,vertical-align,text-align,text-shadow,line-height,letter-spacing,word-spacing,color,background".split(","),function(n,t){var i=f.css(t),r;t=="letter-spacing"&&String(i).indexOf(".")>-1&&(r=Number(String(i).substring(0,String(i).indexOf(".")+2)),i=String(r+"px"));t.in("font-size","letter-spacing","line-height")&&f.css(t,i);l.css(t,i);h.css(t,i)});t.each("line-height,letter-spacing,word-spacing".split(","),function(n,t){f.css(t,f.css(t))});var n={"padding-top":f.css("padding-top"),"padding-bottom":f.css("padding-bottom"),"padding-left":f.css("padding-left"),"padding-right":f.css("padding-right")},i={"padding-left":0,"padding-right":0,"padding-top":0,"padding-bottom":0};h.css(n);l.css(n);f.css(i);c.css(i);jQuery.browser.mozilla&&h.css({"padding-left":"10px","padding-right":"12px"});w&&h.css({"padding-left":"13px","padding-right":"13px"});p.css({position:"relative"});g.css({width:String(y.width()-(jQuery.browser.mozilla?0:w?6:0))+"px"});h.css({position:"absolute",top:0,left:0,"z-index":1,"text-rendering":"optimizeLegibility","font-feature-settings":"normal","-webkit-font-feature-settings":"normal","-moz-font-feature-settings":"normal","font-variant-ligatures":"no-common-ligatures","-webkit-font-variant-ligatures":"no-common-ligatures","font-kerning":"none"});l.css({position:"relative","z-index":2,color:"transparent","background-color":"transparent","text-shadow":"none"});f.css({color:"transparent","background-color":"transparent","text-shadow":"none"}).height(c.height())};this.destroy=function(){f.off(".wealthyTextArea");c.off(".wealthyTextArea")};this.getSelectionRange=function(n){var t=f[0];return("selectionStart"in t&&function(){var n=t.selectionEnd-t.selectionStart;return{start:t.selectionStart,end:t.selectionEnd,length:n,text:t.value.substr(t.selectionStart,n),textBefore:t.value.substr(0,t.selectionStart),textAfter:t.value.substring(t.selectionStart+n),allText:t.value}}||document.selection&&function(n){var i,u,r;return n===!0&&!t._isFocused&&e!=null?{start:e.start,end:e.end,length:e.length,text:e.text,textBefore:e.textBefore,textAfter:e.textAfter,allText:e.allText}:(t.focus(),i=document.selection.createRange(),i==null)?{start:0,end:t.value.length,length:0}:(u=t.createTextRange(),r=u.duplicate(),u.moveToBookmark(i.getBookmark()),r.setEndPoint("EndToStart",u),{start:r.text.length,end:r.text.length+i.text.length,length:i.text.length,text:i.text,textBefore:r.text,textAfter:t.value.substring(r.text.length+i.text.length),allText:t.value})}||function(){return{start:0,end:t.value.length,length:0}})(n)};this.setSelection=function(t,i,r){var e=f[0],h,s,o;u._bIgnoreFocusEvents=!0;h=e._isFocused;t==n.EditorBlock.SELECT_ALL?(t=0,i=e.value.length):t==n.EditorBlock.SELECT_START?t=i=0:t==n.EditorBlock.SELECT_END?t=i=e.value.length:i==null&&(i=t);e.focus();e.setSelectionRange?e.setSelectionRange(t,i):e.createTextRange&&(s=e.value.replace(/\r\n/g,"\n"),t-=s.slice(0,t).split("\n").length-1,i-=s.slice(0,i).split("\n").length-1,o=e.createTextRange(),o.collapse(!0),o.moveEnd("character",i),o.moveStart("character",t),o.select());u._bIgnoreFocusEvents=!1;(h!=e._isFocused||r===!0)&&this._onCursorChange("txtFocus",{},!0)};this.selectStart=function(){this.setSelection(n.EditorBlock.SELECT_START)};this.selectEnd=function(){this.setSelection(n.EditorBlock.SELECT_END)};this.isSelectionAtStart=function(){return e.start==0&&e.end==0};this.isSelectionAtEnd=function(){return e.start==f.val().length&&e.end==f.val().length};this.getLastSelectionRange=function(){return e};this.getValue=function(n){return n!=null&&n&&f.val()==u.settings.defaultText?"":f.val()};this.setValue=function(n,t,i){f.val(n);t!=null?this.setSelection(t,i,!0):(c.html(u.toHtmlMirror(f.val(),e.end,a&&!v)),f.height(c.height()))};this.onMouseDown=function(n){t(window).on({"mouseup.wealthyTextArea":u.onMouseUp});v=!0;u._onCursorChange.apply(u,["mouseDown",n])};this.onMouseUp=function(n){t(window).off("mouseup.wealthyTextArea");v=!1;setTimeout(function(){u._onCursorChange.apply(u,["mouseUp",n,!0])},0)};this.onTxtFocus=function(n){(this._isFocused=!0,u._bIgnoreFocusEvents)||u._onCursorChange.apply(u,["txtFocus",n,!0])};this.onTxtBlur=function(n){(this._isFocused=!1,u._bIgnoreFocusEvents)||u._onCursorChange.apply(u,["txtBlur",n,!0])};this.onTxtKeyDown=function(n){u._onCursorChange.apply(u,["txtKeyDown",n])};this.onTxtKeyUp=function(n){u._onCursorChange.apply(u,["txtKeyUp",n])};this.onTxtPaste=function(n){window.setTimeout(function(){u._onCursorChange.apply(u,["txtPaste",n])},0)};this.onTxtChange=function(n){u._onCursorChange.apply(u,["txtChange",n])};this.onTxtInput=function(n){setTimeout(function(){u._onCursorChange.apply(u,["txtInput",n])},0)};this.onWinResize=function(n,i){var r=t(window).width();(r!=b||i)&&(b=r,g.css({width:String(y.width()-(jQuery.browser.mozilla?0:w?6:0))+"px"}),f.height(c.height()))};this._onCursorChange=function(n,t,i){var h,y,o,l,s,r;u._bIgnoreFocusEvents=!0;i&&(n=="txtFocus"||n=="txtBlur")&&(a=n=="txtFocus");h=u.getSelectionRange(i===!0&&a===!1);(u.compareChanges(h)||i)&&(c.html(u.toHtmlMirror(f.val(),h.end,a&&!v)),f.height(c.height()),u._updateCursorSpanPos(),e=h);u._bIgnoreFocusEvents=!1;n==="txtPaste"&&(y=function(n){var i=u.getSelectionRange(),e=i.allText,r=n||i.allText.substring(Math.max(i.start-2,0),i.start),o=Math.max(i.start-r.length,0),t=-1,s=0,f=[];do t=e.indexOf(r,t+1),~t&&f.push({index:t}),o===t&&(s=f.length-1);while(~t);return{textToMatch:r,textIndex:s,textPosition:o,instancesOfText:f,allText:e}},o=y(),u.cleanup(),l=y(o.textToMatch),s=l.allText,l.instancesOfText.length>=o.instancesOfText.length&&(r=Math.min(l.instancesOfText[o.textIndex].index+o.textToMatch.length,s.length),s[r]===" "&&s[r+1]==="]"&&s[r+2]!=="]"&&r++,u.setSelection(r)))};this._updateCursorSpanPos=function(n){var f=h.find("span.cursor.placeholder"),e,r,i,o,s;if(f.length==0){h.find(".cursor.blinker").remove();return}e=!1;(!rt||n)&&(r=h.find(".cursor.blinker"),i=f.position(),r.length<1?(r=t('<span class="cursor blinker"><\/span>').transform("translate3d("+i.left+"px,"+i.top+"px,0)").appendTo(h),e=!0):r.removeClass("blink").transform("translate3d("+i.left+"px,"+i.top+"px,0)"));o=f.offset();s=t(window).height()-126;o.top>s+t(window).scrollTop()&&t(window).scrollTop(o.top-s);u.baseEditor&&(n||e)&&u.baseEditor.blinkCursors()};s=function(n,t){try{return n.charAt(t+1)}catch(i){return""}};o=function(n,t){try{return n.charAt(t-1)}catch(i){return""}};this.toHtmlMirror=function(i,r,e){var st=jQuery.browser.msie?!0:!1,l,ht,ft,nt,rt;u._bIgnoreFocusEvents=!0;var c="",y=i.length,vt=y-1,w=!1,k=!1,v=!1,tt=!1,d=!1,it=!1,ut=!1,g='<span class="sentenceWrap">';if(i==""||i==u.settings.defaultText){if(i!=u.settings.defaultText){if(e&&u.settings.defaultText!="")return u._bIgnoreFocusEvents=!1,g+'<span class="cursor placeholder"><\/span>&nbsp;<\/span>';f.val(u.settings.defaultText)}else if(e&&u.getSelectionRange(e===!1).end!=f.val().length){u._bIgnoreFocusEvents=!1;u.setSelection(n.EditorBlock.SELECT_END);return}return(u._bIgnoreFocusEvents=!1,e&&r>0&&r<=u.settings.defaultText.length)?u.settings.defaultHtml.indexOf(u.settings.defaultText)>-1?g+u.settings.defaultHtml.replace(u.settings.defaultText,u.settings.defaultText+'<span class="cursor placeholder"><\/span>')+"<\/span>":g+u.settings.defaultHtml.replace(">: ",'>: <span class="cursor placeholder"><\/span>')+"<\/span>":e?g+'<span class="cursor placeholder"><\/span>'+u.settings.defaultHtml+"<\/span>":g+u.settings.defaultHtml+"<\/span>"}for(l=0;l<y;l++){var h=i.charAt(l),p=s(i,l),a=o(i,l);if(l===r?e&&(a==="\n"||a==="\r"||a==""?c+='<span class="cursor placeholder"><span style="display:inline-block"><\/span><\/span>':(c+='<span class="cursor placeholder">',(a===" "||a==="\n"||a==="\r")&&h!==" "&&h!=="\n"&&h!=="\r"&&h!=="-"&&h!=="*"&&h!=="["&&h!=="]"?it=!0:c+="<\/span>")):it&&(h===" "||h==="\n"||h==="\r"||h===""||h==="-"||h==="*"||h==="["||h==="]")&&(it=!1,c+="<\/span>"),this.settings.multiLine)if(d||(d=!0,c+=g),h==="&")c+="&amp;";else if(h==='"')c+="&quot;";else if(h==="'")c+="&#039;";else if(h==="<")c+="&lt;";else if(h===">")c+="&gt;";else if(h==="\n"||h==="\r")h==="\r"&&p==="\n"&&l++,v&&(c+="<\/span>",v=!1),ht=i.lastIndexOf("\n",l-1),ft=Math.max(i.lastIndexOf("\n* ",l-1),i.lastIndexOf("\n- ",l-1),i.lastIndexOf("\n+ ",l-1)),ft>=ht&&ft>-1&&(w&&(c+="<\/strong>",w=!1),k&&(c+="<\/em>",k=!1)),d&&(a==="\n"&&p&&(c+='<span style="display:inline-block;"><\/span>'),c+="<\/span>",d=!1),c+="<br/>";else if(h===" ")v&&tt&&(c+="<\/span>"),c+=p===" "||a==="\n"||a==="\r"?st?"&nbsp;<wbr />":"&nbsp;":st?" <wbr />":" ",v&&tt&&(c+='<span class="markDownLinkText">',tt=!1);else if(v||h!=="*")if(v||h!=="-"&&h!=="+"||p!==" "&&p!=""&&p!=="\n"&&p!=="\r"||a!=="\n"&&a!=="\r"&&a!="")if(v||h!=="_")if(h==="["||h==="]")if(v||p!==h)if(v&&h==="[")c+="[";else if(tt=v=h==="[",v){var ct=Math.min(i.indexOf(" ",l+1)>-1?i.indexOf(" ",l+1):999999999999999,i.indexOf("]",l+1)>-1?i.indexOf("]",l+1):999999999999999,i.indexOf("\n",l+1)>-1?i.indexOf("\n",l+1):999999999999999),b=i.substring(l+1,ct),lt=String(ct>l+1&&(n.UrlRegEx.urlExact.test(b)||n.UrlRegEx.relUrlExact.test(b))?"markDownURL":"markDownURLInvalid"),et=u&&u.baseEditor?u.baseEditor.getMatchedEmbedList():[],ot=u&&u.baseEditor?u.baseEditor.getLoadingEmbedList():[],at=u&&u.baseEditor?u.baseEditor.getLoadedEmbedList():[];et&&et.length>0&&~t.inArray(b,et)&&!~t.inArray(b,at)&&!~t.inArray(b,ot)&&(~t.inArray(b,ot)||ot.push(b),window.setTimeout(function(){var n=u.baseEditor.getRoot().find(".linkDummyContainer");n.length<1&&(n=t('<div class="hide linkDummyContainer" style="width:0;height:0;display:none;color:#0C743A;"><\/div>').appendTo(u.baseEditor.getRoot()),u.baseEditor._initLinkLoader(n))},0));c+='<span class="markDown">[<\/span><span class="'+lt+'">'}else c+='<\/span><span class="markDown">]<\/span>';else c+=h+(e&&r==l+1?'<span class="cursor placeholder"><\/span>':"")+i.charAt(l++);else h==="—"&&p!=="—"&&t.browser.webkit?c+="—<wbr />":d&&!v&&(h==="."||h==="!"||h==="?"||h===";"||l===y.length-1)?(d=!1,c+=h+"<\/span>"):c+=h;else p==="_"?(c+=e&&r==l+1?'_<span class="cursor placeholder"><\/span>_':"__",l++):(c+=k?'<span class="markDown">_<\/span><\/em>':'<em><span class="markDown">_<\/span>',k=!k);else c+='<span class="markDownReplace">'+h+"<span>&bull;<\/span><\/span>";else nt=p,rt=a,nt==="*"?(c+=e&&r==l+1?'*<span class="cursor placeholder"><\/span>*':"**",l++):(nt===" "||nt==""||nt==="\n"||nt==="\r")&&(rt==="\n"||rt==="\r"||rt=="")?c+='<span class="markDownReplace">*<span>&bull;<\/span><\/span>':w?(c+='<span class="markDown">*<\/span><\/strong>',w=!w):(c+='<strong><span class="markDown">*<\/span>',w=!w);else c+=h==="&"?"&amp;":h==='"'?"&quot;":h==="'"?"&#039;":h==="<"?"&lt;":h===">"?"&gt;":h,!ut&&this.settings.maxLength>0&&l>=this.settings.maxLength&&(ut=!0,c+='<span class="too-long">')}return ut&&(c+="<\/span>"),w&&(c+="<\/strong>"),k&&(c+="<\/em>"),e&&r==y&&(c+=o(i,y)=="\n"||o(i,y)=="\r"?'<span class="cursor placeholder">&nbsp;<\/span>':'<span class="cursor placeholder"><\/span>'),(i.charAt(y-1)=="\r"||i.charAt(y-1)=="\n"||i.charAt(y-1)==" "&&(i.charAt(y-2)=="\r"||i.charAt(y-2)=="\n"))&&(c+="&nbsp;"),it&&(c+="<\/span>"),u._bIgnoreFocusEvents=!1,c};this.html=function(){var r,a,k,nt,w,d,g;if(!this.settings.multiLine)return this.getValue().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");var u=t.trim(this.getValue()),i="<p>",b=u.length,ut=b-1,c=!1,y=!1,h=!1,p=!1,f=!1,e=!1,l=!1;for(r=0;r<b;r++)if(u.charAt(r)=="&")i+="&amp;";else if(u.charAt(r)=='"')i+="&quot;";else if(u.charAt(r)=="'")i+="&#039;";else if(u.charAt(r)=="<")i+="&lt;";else if(u.charAt(r)==">")i+="&gt;";else if(u.charAt(r)=="\n"||u.charAt(r)=="\r")u.charAt(r)=="\r"&&s(u,r)=="\n"&&r++,h&&(i+="<\/a>",h=!1),c&&(i=i.substring(0,i.lastIndexOf("<strong>"))+"*"+i.substring(i.lastIndexOf("<strong>")+8,i.length),c=!1),y&&(i=i.substring(0,i.lastIndexOf("<em>"))+"_"+i.substring(i.lastIndexOf("<em>")+4,i.length),y=!1),l?(i+="<\/li>\n",l=!1):o(u,r)=="\n"&&(e||f)?e?(i+="<\/ol><p>",e=!1):f&&(i+="<\/ul><p>",f=!1):i+="<br/>";else if(u.charAt(r)==" "&&(s(u,r)==" "||o(u,r)=="\n"||o(u,r)=="\r"))i+="";else if(h||u.charAt(r)!="*")if(h||u.charAt(r)!="-"&&u.charAt(r)!="+"||s(u,r)!=" "&&s(u,r)!=""&&s(u,r)!="\n"&&s(u,r)!="\r"||o(u,r)!="\n"&&o(u,r)!="\r"&&o(u,r)!="")if(h||u.charAt(r)!="_")if(u.charAt(r)=="["||u.charAt(r)=="]")if(h||s(u,r)!=u.charAt(r))if(h&&u.charAt(r)=="[")i+="[";else if(h=u.charAt(r)=="[",h){var rt=Math.min(u.indexOf(" ",r+1)>-1?u.indexOf(" ",r+1):999999999999999,u.indexOf("]",r+1)>-1?u.indexOf("]",r+1):999999999999999,u.indexOf("\n",r+1)>-1?u.indexOf("\n",r+1):999999999999999),v=u.substring(r+1,rt),tt=v.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\'/g,"&#039;");if(n.UrlRegEx.urlExact.test(v)){for(i+='<a href="'+n.Scheme.correctNative(String(it.test(v)?"":"http://")+v.replace(/&/g,"&amp;").replace(/"/g,"&quot;"))+'">',r+=v.length;u.charAt(r+1)==" ";)r++;p=!0}else if(n.UrlRegEx.relUrlExact.test(v)){for(i+='<a href="'+tt+'">',r+=v.length;u.charAt(r+1)==" ";)r++;p=!0}else p=!1}else p&&(nt=i.substring(i.lastIndexOf(">")+1),(nt.length===0||nt===" ")&&(i+=tt),i+="<\/a>",p=!1);else i+=u.charAt(r++);else if((o(u,r)=="\n"||o(u,r)=="")&&u.charAt(r).match(/[1-9]/)){for(w=u.charAt(r++);r<b&&u.charAt(r).match(/[0-9]/);)w+=u.charAt(r++);r<b&&u.charAt(r)=="."&&s(u,r)==" "?(f?(i+="<\/ul><ol>",f=!1,e=!0):e||(i+=w=="1"?"<\/p><ol>":'<\/p><ol start="'+w+'">',e=!0),i+="<li>",l=!0,r++):(i+=w,r--)}else(f||e)&&!l&&(e?(i+="<\/ol><p>",e=!1):f&&(i+="<\/ul><p>",f=!1)),i+=u.charAt(r);else s(u,r)=="_"?(i+="_",r++):(i+=y?"<\/em>":"<em>",y=!y);else e?(i+="<\/ol><ul>",e=!1,f=!0):f||(i+="<\/p><ul>",f=!0),i+="<li>",l=!0;else a=s(u,r),k=o(u,r),a=="*"?(i+="*",r++):(a==" "||a==""||a=="\n"||a=="\r")&&(k=="\n"||k=="\r"||k=="")?(e?(i+="<\/ol><ul>",e=!1,f=!0):f||(i+="<\/p><ul>",f=!0),i+="<li>",l=!0,a==" "&&r++):c?(i+="<\/strong>",c=!c):(i+="<strong>",c=!c);return c&&(i=i.substring(0,i.lastIndexOf("<strong>"))+"*"+i.substring(i.lastIndexOf("<strong>")+8,i.length)),y&&(i=i.substring(0,i.lastIndexOf("<em>"))+"_"+i.substring(i.lastIndexOf("<em>")+4,i.length)),l&&(i+="<\/li>"),i+=e?"<\/ol>":f?"<\/ul>":"<\/p>",i=t.trim(HTMLtoXML(i.replace(/\&#039;/g,"'").replace(/\<br\/\>[\s]*<br\/\>/g,"<\/p><p>").replace(/<p>[\s]*<br\/>/g,"<p>").replace(/<br\/>[\s]*<\/p>/g,"<\/p>").replace(/<li>[\s]*<\/li>/g,"").replace(/<[uo]l(start="[0-9]+")?>[\s]*<\/[uo]l>/g,"").replace(/<p>[\s]*<\/p>/g,"").replace(/\s+/g," ")).replace(/\<br\/\>[\s]*<br\/\>/g,"<\/p><p>").replace(/<p>[\s]*<br\/>/g,"<p>").replace(/<br\/>[\s]*<\/p>/g,"<\/p>").replace(/<li>[\s]*<\/li>/g,"").replace(/<[uo]l(\sstart="[0-9]+")?>[\s]*<\/[uo]l>/g,"").replace(/<p>[\s]*<\/p>/g,"").replace(/\s+/g," ")),d=HTMLtoWTE(i),g=t.trim(d[0].value),g!=u&&(console.log("====== Converted WTE Markdown: "),console.log(u),console.log("====== Generated Valid XHTML: "),console.log(i),console.log("====== Converted Back to WTE Mark-Down ("+String(g==u?"equal":"NOT EQUAL")+"):"),console.log(g)),d.length>1&&(console.log("====== Multiple WTE Blocks: "),console.dir(d)),i};this.cleanup=function(){for(var e=this.getValue(!0),n=t.trim(e),r,s,h;n.match(/(\n|^)(\* |- |\+ )( )*(\n|$)/);)n=n.replace(/(\n|^)(\* |- |\+ )( )*(\n|$)/g,"\n").replace(/(\n|^)(\*|-|\+)( )*$/g,"\n");while(n.match(/(  )|(( )*(\r)?\n( )*(\r)?\n( )*(\r)?\n( )*)|( (\r)?\n)|((\r)?\n )/))n=n.replace(/(  )/g," ").replace(/( )*(\r)?\n( )*(\r)?\n( )*(\r)?\n( )*/g,"\n\n").replace(/( )(\r)?\n/g,"\n").replace(/\n( )/g,"\n");for(var f=k.exec(n),l=0,c=this.baseEditor||i.parents(".share-widget").data("whtPostEditor"),a=c.getMatchedEmbedList(),o=null;f&&f.index>=0&&++l<100&&c.isInited();)r=f[0],s=r.replace(/^\[+|\]+$/,""),r.indexOf("[")<0&&r.indexOf("]")<0&&(n=ft(r,f.index,n),o=f.index+r.length+2),!~t.inArray(s,a)&&(r.match(d)||r.match(tt))&&ut(s,r),f=k.exec(n);n=n.replace(/([^\n])((\r)?\n)(?!(\* |- |\+ |[0-9]+\. ))([^\n]{120,})/g,function(){return arguments[1]+"\n\n"+arguments[5]});n=n.replace(/([^\n]{120,})((\r)?\n)(?!(\* |- |\+ |[0-9]+\. ))([^\n])/g,function(){return arguments[1]+"\n\n"+arguments[5]});e!=n&&this.setValue(n);this.settings.multiLine&&(h=HTMLtoWTE(this.html()),n=t.trim(h[0].value),e!=n&&this.setValue(n),h.length>1);o!==null&&u.setSelection(o)};this.compareChanges=function(n){var t=e;return n.start!=t.start||n.end!=t.end||n.text!=t.text||n.allText.length!=t.allText.length?(t.beforeText!=n.beforeText,e=n,!0):!1}};t.fn.wealthyTextArea=function(i){return this.each(function(){var r=t(this),u;if(r.data("wealthyTextArea"))return r.data("wealthyTextArea");u=new n.WealthyTextEditor(r,i);r.data("wealthyTextArea",u);u.init()})}}(window.WHT=window.WHT||{},jQuery),function(){var n=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(i){function u(){!n&&this.init&&this.init.apply(this,arguments)}var e=this.prototype,f,r;n=!0;f=new this;n=!1;for(r in i)f[r]=typeof i[r]=="function"&&typeof e[r]=="function"&&t.test(i[r])?function(n,t){return function(){var r=this._super,i;return this._super=e[n],i=t.apply(this,arguments),this._super=r,i}}(r,i[r]):i[r];return u.prototype=f,u.prototype.constructor=u,u.extend=arguments.callee,u}}(),function(n,t){n.EditorBlock=Class.extend({EB_TYPE:"undefined",IS_TEXT:!1,CAN_MERGE_WITH_TWIN:!1,CAN_HAVE_TWIN_NEIGHBOR:!1,CAN_SET_SELECTION:!0,CAN_BE_SPLIT:!1,CAN_SPLIT_BLOCKS:!1,ATTACHMENT_MODE:0,INTERCEPT_MENU_BUTTONS:[],FOLLOW_WITH_BLOCK_TYPE:"",settings:{attachToolbox:!1,followWithBlockOptions:{}},toolbox:{buttons:[{action:"bold",text:"Bold",tip:"Toggle bold text by surrounding with asterix's (ex: *bold*)",icon:"fa-bold",visible:!0,enabled:!0},{action:"italic",text:"Italic",tip:"Toggle italic text by surrounding with underscores (ex: _italic_)",icon:"fa-italic",visible:!0,enabled:!0},{action:"link",text:"Link",tip:"And a link by surrounding a URL and its text with square brackets (ex: [http://myurl.com link text])",icon:"fa-link",visible:!0,enabled:!0},{action:"list-ul",text:"Bullet List",tip:"Toggle bullet list by starting each line with an asterix (ex: * my first list item)",icon:"fa-list-ul",visible:!0,enabled:!0},{action:"list-ol",text:"Numbered List",tip:"Toggle numbered list by starting each line with a number and a period (ex: 1. My first list item)",icon:"fa-list-ol",visible:!0,enabled:!0},{action:"quote",text:"Quote",tip:"Add a new quote",icon:"fa-quote-left",visible:!0,enabled:!0},{action:"image",text:"Image",tip:"Insert an Image",icon:"fa-image",visible:!0,enabled:!0},{action:"video",text:"Video",tip:"Embed a Video",icon:"fa-film",visible:!0,enabled:!0},{action:"step",text:"Step 1",tip:"Add a new step headline",icon:"",visible:!0,enabled:!0},{action:"headline",text:"Head<wbr/>line",tip:"Add a new sub-headline",icon:"",visible:!0,enabled:!0}]},toolboxOverrides:{buttons:[{action:"list-ul",visible:!1},{action:"list-ol",visible:!1}]},blockID:null,baseEditor:null,baseElement:null,isFocused:!1,destroy:function(){var i=t(".editor-tools-"+this.blockID),n=i.data("toolbox");n&&n.destroy&&(i.off("click"),n.destroy());this.baseElement.remove();this.blockID=null;this.self=null;this.baseEditor=null},split:function(){t.error(".split() not implemented by this EditorBlock")},splittingOtherBlock:function(){t.error(".splitOtherBlock() not implemented by this EditorBlock")},merge:function(n){return this.CAN_MERGE_WITH_TWIN&&n!=null&&n.EB_TYPE==this.EB_TYPE?(this.EB_TYPE=="EBWealthyParagraph"?this.xml(n.wte.html(),!0):this.EB_TYPE=="EBWealthyBlockquote"?this.xml(n.wte.html(),!0):this.xml(n.xml(),!0),this.baseEditor.deleteBlock(n),!0):!1},mergeWithNext:function(){var n=this.getNextBlock();return!!(n&&this.merge(n))},xml:function(){return t.error(".xml() not implemented by this EditorBlock"),""},blockIndex:function(){t.error(".blockIndex() not implemented by this EditorBlock")},isEmpty:function(){return t.error(".isEmpty() not implemented by this EditorBlock"),!1},init:function(){t.error(".init() not implemented by this EditorBlock")},initToolbox:function(){var r=this,f=t(".editor-toolbox"),u,o,e,i,n;if(f.length==0)if(r.settings.attachToolbox)f=r.attachToolbox();else return;for(f.empty(),u={},t.extend(!0,u,r.toolbox),i=0;i<r.toolboxOverrides.buttons.length;i++){for(o=!1,e=0;e<u.buttons.length;e++)u.buttons[e].action==r.toolboxOverrides.buttons[i].action&&(t.extend(!0,u.buttons[e],r.toolboxOverrides.buttons[i]),o=!0);o||u.buttons.unshift(r.toolboxOverrides.buttons[i])}for(i=0;i<u.buttons.length;i++)n=u.buttons[i],n.visible&&(n.custom!=null?f.append(r[n.custom].apply(r,[])):f.append('<button class="tooltip'+(n.icon==""?" wide":"")+(n.enabled?"":" disabled")+'" title="'+n.tip+'" data-action="'+n.action+'" tabindex="-1">'+(n.icon==""?n.text:'<i class="fa '+n.icon+'"><\/i>')+"<\/button>"))},attachToolbox:function(){var n=this,i;n.baseElement.css("margin-top","80px").append('<div class="toolbox-anchor"><div class="lockable-toolbox '+(n.baseEditor._mode=="post"?"full-width-centered-article-content":"centered-article-content")+" editor-toolbox editor-tools-"+n.blockID+'"><\/div><\/div>');i=t(".editor-tools-"+n.blockID).toolbox();i.on("click","button",function(i){var r=t(i.currentTarget);r.hasClass("disabled")||n.baseEditor._onToolboxClick(r.data("action"));i.stopPropagation();i.stopImmediatePropagation();i.preventDefault()});return i},initDroppable:function(){var i=this,u=[],r={},s=function(){i.baseElement.addClass("droppableActive");u=f();var r=n.Throttle(function(){u=f()},100);t(window).on("scroll.whtPostEditor",r)},e=function(n,u){var f;if(i.baseElement.removeClass("droppableActive"),i.baseElement.find(".cursor").remove(),t(window).off("scroll.whtPostEditor"),n.type==="drop"&&r&&r.el){f=0;i.displayElement.find(".sentenceWrap").each(function(){var n=t(this);return this===r.el&&r.isTopLeft||(f+=n.text().length),n.prev().prop("tagName")==="BR"&&f++,this!==r.el});i.setFocused(!0);i.wte.setSelection(f,f,!0);i.split();var s=i.getPrevBlock(),h=i.getNextBlock(),e=u.draggable.parent().parent(),o=i.baseEditor.getBlockByBlockID(e.data("blockID")),c=o.getPrevBlock(),l=o.getNextBlock();i.baseElement.after(e);h&&h.mergeWithNext();s&&s.mergeWithNext();c&&c.mergeWithNext();l&&l.mergeWithNext();e.scrollTo({offSetTop:50});o.setFocused(!0)}},f=function(){var n=[],t=i.displayElement.find(".sentenceWrap");return t.each(function(t,i){var r=i&&i.getClientRects&&i.getClientRects();r&&r.length>0&&(n.push({el:i,x:r[0].left,y:r[0].top,height:r[0].height,width:r[0].width,isTopLeft:!0}),n.push({el:i,x:r[r.length-1].left+r[r.length-1].width,y:r[r.length-1].top,height:r[r.length-1].height,width:r[r.length-1].width,isTopLeft:!1}))}),n},h=function(n,t){var i=n.x-t.x,r=n.y-t.y;return Math.sqrt(i*i+r*r)},o;if(i.baseElement&&i.baseElement.length>0&&i.CAN_BE_SPLIT&&i.baseElement.droppable({over:s,out:e,drop:e,tolerance:"touch"}),o=n.Throttle(function(n){var e,s,l;if(i.baseEditor&&i.baseEditor.isDragging()&&i.baseElement.hasClass("droppableActive")&&(e=i.displayElement.find(".cursor.placeholder"),s={x:n.clientX,y:n.clientY},u=u&&u.length>0?u:f(),!(u.length<1)&&i.baseEditor&&i.baseEditor.isDragging())){e.length<1&&(e=t('<span class="cursor placeholder"><span style="display:inline-block;"><\/span><\/span>'));var a=r,o=99999999,v=o,c=[],y=0;c=[];t.each(u,function(n,t){var i=Math.abs(s.y-(t.y+t.height/2));i<=o&&(t.yDist=o=i,c.push(t))});t.each(c,function(n,t){var i=h(s,t);i<v&&t.yDist<=o&&(v=i,y=n)});r=u[y];l=r.el;r.isTopLeft?e.insertBefore(l):e.insertAfter(l);a&&a.el!==r.el&&i.wte._updateCursorSpanPos(!0)}},100),i.displayElement&&i.displayElement.length>0&&i.wte)i.baseElement.on("mousemove",o)},getSelectionRange:function(){t.error(".getSelectionRange() not implemented by this EditorBlock")},setSelection:function(){t.error(".setSelection() not implemented by this EditorBlock")},setFocused:function(n){this.isFocused!=n&&(this.isFocused=n,this.baseElement.toggleClass("isFocused",this.isFocused),this.isFocused?(this.initToolbox(),this.triggerFocusThisBlock(),this.onGotFocus()):this.onLostFocus())},getNextBlock:function(){return this.baseEditor&&this.baseEditor.getNextBlock(this)},getPrevBlock:function(){return this.baseEditor&&this.baseEditor.getPrevBlock(this)},isFirstBlock:function(){var n=this.baseEditor.getFirstBlock();return n!=null&&n.blockID==this.blockID},isLastBlock:function(){var n=this.baseEditor.getLastBlock();return n!=null&&n.blockID==this.blockID},onWinResize:function(){},onGotFocus:function(){},onLostFocus:function(){},triggerFocusPreviousBlock:function(){var n=t.Event("focusPreviousBlock");n.fromBlock=this;this.baseElement.trigger(n)},triggerFocusThisBlock:function(){var n=t.Event("focusThisBlock");n.fromBlock=this;this.baseEditor.onFocusThisBlock(n)},triggerFocusNextBlock:function(){var n=t.Event("focusNextBlock");n.fromBlock=this;this.baseElement.trigger(n)},triggerDeleteBlock:function(){var n=t.Event("deleteBlock");n.fromBlock=this;this.baseEditor.onDeleteBlock(n)},triggerUpdateDefaultTip:function(){var n=t.Event("updateDefaultTip");n.fromBlock=this;this.baseElement.trigger(n)}});n.EditorBlock.AM_APPEND_NEXT=0;n.EditorBlock.AM_APPEND_BOTTOM=1;n.EditorBlock.AM_SPLIT=2;n.EditorBlock.SELECT_START="s";n.EditorBlock.SELECT_END="e";n.EditorBlock.SELECT_ALL="a";n.EditorBlock.BlockID=88e4;n.EditorBlock.BlockTypes={}}(window.WHT=window.WHT||{},jQuery),function(n,t){n.EditorBlock.BlockTypes.EBWealthyParagraph=n.EditorBlock.extend({EB_TYPE:"EBWealthyParagraph",IS_TEXT:!0,CAN_MERGE_WITH_TWIN:!0,CAN_HAVE_TWIN_NEIGHBOR:!1,CAN_BE_SPLIT:!0,ATTACHMENT_MODE:0,INTERCEPT_MENU_BUTTONS:["MenuLink","MenuImage"],FOLLOW_WITH_BLOCK_TYPE:"",settings:{attachToolbox:!1,defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Click to start a new paragraph...<\/span>',multiLine:!0},toolboxOverrides:{buttons:[{action:"list-ul",visible:!1},{action:"list-ol",visible:!1}]},minimumHeights:[22,154],init:function(i,r){this.blockID=n.EditorBlock.BlockID++;this.self=this;this.baseEditor=i;this.txtElement=null;this.baseElement=null;this.wte=null;var u={};t.extend(!0,u,this.settings);r&&t.extend(!0,u,r);this.settings=u;this._build();this._initEvents();this.settings.xml&&this.xml(this.settings.xml)},split:function(){var n=this,t=n.getSelectionRange(),i=n.baseEditor.attachBlockWithDefaultOptions("EBWealthyParagraph",!0,!0);n.wte.setValue(t.textBefore);n.wte.cleanup();i.wte.setValue(t.textAfter);i.wte.cleanup()},setHtml:function(t){for(var i,f,u=HTMLtoWTE(t),r=0;r<u.length;r++){if(i=u[r],r==0){this.wte.setValue(i.value,n.EditorBlock.SELECT_END);continue}switch(i.type){case"EBWealthySubHeadline":case"EBWealthySubHeadlineStep":this.baseEditor.attachBlockWithDefaultOptions(i.type,!0);f=this.baseEditor.getFocusedBlock();f.wte.setValue(i.value);f.settings.autoCapitalize=i.autoCapitalize;break;case"EBWealthyParagraph":this.baseEditor.attachBlockWithDefaultOptions(i.type,!0);this.baseEditor.getFocusedBlock().wte.setValue(i.value);break;case"EBWealthyBlockquote":this.baseEditor.attachBlockWithDefaultOptions(i.type,!0);this.baseEditor.getFocusedBlock().setValueFromWTEParsedHtml(i);break;case"EBGallery":this.baseEditor.attachBlockWithDefaultOptions(i.type,!0);this.baseEditor.getFocusedBlock().xml(i.value)}}u.length>1&&this.baseEditor.updateStepNumbers()},xml:function(n,i){var u,f,r;if(n!=null&&typeof n=="string"){if(n=t.trim(n),r="",n.indexOf("<DocPart")!=0&&n.indexOf("<HtmlText")!=0)r=n;else try{u=t(t.parseXML(n).firstChild);f=t(u.first()[0].nodeName=="DocPart"?u.find(":first-child"):u);r=f.first()[0].nodeName=="HtmlText"?f.html():f.find("HtmlText").html()}catch(e){console.log("Error Parsing XML for TextArea:\n"+n);console.dir(e)}this.setHtml(i===!0?t.trim(t.trim(this.wte.html())+t.trim(r)):r)}return(r=t.trim(this.wte.html()),r=="")?"":'<DocPart PartType="TextBlock" id="docPartTxt'+this.blockID+'"><HtmlText>'+r+"<\/HtmlText><\/DocPart>"},blockIndex:function(){t.error("!!!.blockIndex() not implemented by this EBWealthyParagraph")},isEmpty:function(){return t.trim(this.wte.getValue())==""},getSelectionRange:function(){return this.wte.getLastSelectionRange()},setSelection:function(n,t){this.wte.setSelection(n,t)},onWinResize:function(n){if(this.wte!=null)this.wte.onWinResize(n)},onGotFocus:function(){this.txtElement[0]._isFocused||this.txtElement[0].focus()},onLostFocus:function(){this.wte!=null&&this.wte.cleanup()},onKeyPress:function(i){var e,h,u,f,o,s,r;switch(i.keyCode||i.which){case 13:if(this.settings.multiLine){if(u=t.browser.msie&&t.browser.version<9?"\r\n":"\n",r=this.wte.getLastSelectionRange(),r.textBefore.match(/((\r\n|\n|^)(\* |- |\+ )( )*)$/))return f=0,this.wte.setValue(r.textBefore.replace(/((\r\n|\n|^)(\* |- |\+ )( )*)$/,function(){return f=arguments[3].length,arguments[2]})+(r.textAfter.length>0||r.start<4?r.textAfter:u),r.textAfter.length>0||r.start<4?r.start-f:r.start-f+u.length),!1;if(r.textBefore.match(/((\r\n|\n|^)(([1-9][0-9]*)(\.\)|:\)|\.|\)|:) )( )*)$/))return f=0,this.wte.setValue(r.textBefore.replace(/((\r\n|\n|^)(([1-9][0-9]*)(\.\)|:\)|\.|\)|:) )( )*)$/,function(){return f=arguments[3].length,arguments[2]})+(r.textAfter.length>0||r.start<5?r.textAfter:u),r.textAfter.length>0||r.start<5?r.start-f:r.start-f+u.length),!1;if(r.textBefore.match(/(\r\n|\n|^)(\* |- |\+ )[^\n]+$/))return this.wte.setValue(r.textBefore+u+r.textBefore.match(/(\r\n|\n|^)(\* |- |\+ )[^\n]+$/)[2]+r.textAfter,r.start+2+u.length),!1;if(r.textBefore.match(/(\r\n|\n|^)(([1-9][0-9]*)(\.\)|:\)|\.|\)|:) )[^\n]+$/))return o=r.textBefore.match(/(\r\n|\n|^)(([1-9][0-9]*)(\.\)|:\)|\.|\)|:) )[^\n]+$/),s=String(Number(o[3])+1)+o[4]+" ",this.wte.setValue(r.textBefore+u+s+r.textAfter,r.start+s.length+u.length),!1}else return this.triggerFocusNextBlock(),e=this.baseEditor.getFocusedBlock(),e.blockID==this.blockID||e.EB_TYPE!="EBWealthyParagraph"&&this.FOLLOW_WITH_BLOCK_TYPE=="EBWealthyParagraph"?(this.triggerFocusThisBlock(),h=this.baseEditor._attachEditorBlock(this.FOLLOW_WITH_BLOCK_TYPE,this.settings.followWithBlockOptions,n.EditorBlock.AM_APPEND_NEXT),this.baseEditor.setFocusedBlock(h)):e.IS_TEXT&&e.setSelection(n.EditorBlock.SELECT_START),!1;break;case 32:if(r=this.wte.getLastSelectionRange(),r.start==0||r.textBefore.match(/((  )|\n)$/))return r.end>r.start&&this.wte.setValue(r.textBefore+r.textAfter,r.start),!1;if(r.textAfter.match(/^(  )/)||r.textAfter.match(/^( )/)&&r.textBefore.match(/( )$/))return r.end>r.start?this.wte.setValue(r.textBefore+r.textAfter,r.start):this.wte.setSelection(r.start+1),!1;if(r.textBefore.lastIndexOf("[")>-1&&r.textAfter.substring(0,1)==" "&&r.textBefore.lastIndexOf("]")<r.textBefore.lastIndexOf("[")&&r.textBefore.lastIndexOf(" ")<r.textBefore.lastIndexOf("[")&&r.textBefore.lastIndexOf("\n")<r.textBefore.lastIndexOf("["))return this.wte.setSelection(r.start+1),!1}return!0},onKeyDown:function(t){var h,c,r,a,u,v,f,e,o,s,i;switch(t.keyCode||t.which){case 8:if(this.wte.isSelectionAtStart()&&this.wte.getLastSelectionRange().length==0){if(this.wte.getValue(!0)=="")return this.settings.multiLine?(h=this.baseEditor,c=this.getPrevBlock(),this.triggerDeleteBlock(),c!=null&&c.blockID!==this.blockID&&h.attachBlockWithDefaultOptions.apply(h,["EBWealthyParagraph",!0,!0])):this.triggerDeleteBlock(),!1}else return!0;case 37:case 38:if(t.shiftKey)break;if(this.wte.isSelectionAtStart()){for(r=this.baseEditor.getPrevBlock(this),a=10;r!=null&&r.blockID!=this.blockID&&--a>0;)r.IS_TEXT?r.setSelection(n.EditorBlock.SELECT_END):r=this.baseEditor.getPrevBlock(r);return!1}break;case 39:case 40:if(t.shiftKey)break;if(this.wte.isSelectionAtEnd()){for(u=this.baseEditor.getNextBlock(this),v=10;u!=null&&u.blockID!=this.blockID&&--v>0;)if(u.IS_TEXT){u.setSelection(n.EditorBlock.SELECT_START);break}else u=this.baseEditor.getNextBlock(u);return!1}break;case 9:if(t.shiftKey||!this.settings.multiLine)break;if(i=this._wrapNeghiboringOpenersAndClosers(this.wte.getLastSelectionRange(),"[","]"),f=this._getSelectionCoverageBetween(i,"[","]"),f.isWrappedInRange)return this.setSelection(i.end+f.endCharsAfterRange),!1;if(f.startCharsBeforeRange>0&&f.endCharsAfterRange==0)return this.wte.setValue(i.textBefore+i.text+"]"+i.textAfter,i.end+1),!1;break;case 219:if(t.shiftKey||!this.settings.multiLine)break;var i=this.wte.getLastSelectionRange(),l=i.textAfter.indexOf("]"),y=i.textAfter.indexOf("["),p=i.textAfter.indexOf("\n");if(l<0||y>-1&&y<l||p>-1&&p<l){for(e=0,o=i.textBefore.length-1;o>=0;o--)if(i.textBefore.charAt(o)=="[")e++;else break;if(s=!(i.text==""||Math.max(i.text.indexOf("\n"),i.text.indexOf("]"),i.text.indexOf("["))>-1),s&&!(e>0&&e%2>0))return this.wte.setValue(i.textBefore+"[ "+String(s?i.text:"")+"]"+String(s||i.text==""?"":" "+i.text)+i.textAfter,i.start+1),!1}break;case 221:if(t.shiftKey||!this.settings.multiLine)break;if(i=this.wte.getLastSelectionRange(),i.textBefore.lastIndexOf("[")>-1&&i.textAfter.substring(0,1)=="]"&&i.textBefore.lastIndexOf("]")<i.textBefore.lastIndexOf("[")&&i.textBefore.lastIndexOf("\n")<i.textBefore.lastIndexOf("["))return this.wte.setSelection(i.start+1),!1;break;case 66:if(!(t.ctrlKey||t.metaKey)||t.altKey||!this.settings.multiLine)break;this.onToggleFormatting("bold");return!1;case 73:if(!(t.ctrlKey||t.metaKey)||t.altKey||!this.settings.multiLine)break;this.onToggleFormatting("italic");return!1;case 75:if(!(t.ctrlKey||t.metaKey)||t.altKey||!this.settings.multiLine)break;this.onToggleFormatting("link");return!1;case 76:if(!(t.ctrlKey||t.metaKey)||!this.settings.multiLine)break;this.onToggleFormatting("bulletlist");return!1;case 72:if(!(t.ctrlKey||t.metaKey)||t.altKey)break;return this.baseEditor.attachBlockWithDefaultOptions("EBWealthySubHeadline"),!1;case 51:if(!(t.ctrlKey||t.metaKey)||t.altKey)break;return this.baseEditor.attachBlockWithDefaultOptions("EBWealthySubHeadlineStep"),!1}return!0},onMenuButtonClick:function(n){var t,r;if(this.settings.multiLine&&n=="EBLink"&&(t=this.wte.getLastSelectionRange(),t.text!="")){var i=t.textAfter.indexOf("]"),u=t.textAfter.indexOf("["),f=t.textAfter.indexOf("\n");if(i<0||u>-1&&u<i||f>-1&&f<i)return r=!(t.text==""||Math.max(t.text.indexOf("\n"),t.text.indexOf("]"),t.text.indexOf("["))>-1),this.wte.setValue(t.textBefore+"[ "+String(r?t.text:"")+"]"+String(r||t.text==""?"":" "+t.text)+t.textAfter,t.start+1),!1}return!0},onToggleFormatting:function(i){var r,s,e,o,w,y;switch(i){case"bold":this._toggleFormattingForWrapperChar("*");break;case"italic":this._toggleFormattingForWrapperChar("_");break;case"link":if(r=this._wrapNeghiboringOpenersAndClosers(this.wte.getLastSelectionRange(),"[","]"),this._getSelectionCoverageBetween(r,"*","*").isContainedInRange||this._getSelectionCoverageBetween(r,"_","_").isContainedInRange){this.wte.setValue(r.textBefore+r.text+r.textAfter,r.start+1,r.end-1);this.onToggleFormatting("link");return}if(s=this._getSelectionCoverageBetween(r,"[","]"),s.isWrappedInRange){if(!s.isContainedInRange){this.wte.setValue(r.textBefore+r.text+r.textAfter,r.start-s.startCharsBeforeRange,r.end+s.endCharsAfterRange);this.onToggleFormatting("link");return}var a=r.text.substr(1,r.text.length-2),c=t.trim(a),b=c.length!=a.length,v=a.split(" "),h=c.split(" "),p=!1,l=!1,f="",u="";if(n.UrlRegEx.urlExact.test(v[0])||n.UrlRegEx.relUrlExact.test(v[0])?(p=!0,u=v[0],h.length>1&&h[0]!=h[1]&&(l=!0,f=t.trim(c.split(u).join("")))):h.length>0&&h[0].length>0&&(l=!0,f=c),e=r.text,p)l?confirm("Remove Link?")&&(e=f):(f=prompt("Enter clickable text for this link:",""),f!=null&&(f=t.trim(f),e="["+u+" "+f+"]"));else{for(o=!1;!o;)o=!0,u=prompt("Enter a URL to link to:","http://"),u!=null?(o=n.UrlRegEx.urlExact.test(u)||n.UrlRegEx.relUrlExact.test(u),o||alert('Sorry, "'+u+'" is not a valid URL.'),u=n.Scheme.correctNative(u)):e=f;o&&u!=null&&(l||(f=prompt("Enter the text you would like to be clickable for this link:","")||""),e="["+u+" "+f+"]")}this.wte.setValue(r.textBefore+e+r.textAfter,r.start+e.length)}else if(r.text==""){if(this._isSelectionInWord(r,!0,!0)){this.onToggleFormatting("link");return}if(this._isSelectionInWord(r,!0)){this.onToggleFormatting("link");return}this.wte.setValue(r.textBefore+"[ ]"+r.textAfter,r.start+1);this.onToggleFormatting("link")}else if(!(r.text.indexOf("\n")>-1))if(w=n.UrlRegEx.urlExact.test(r.text)||n.UrlRegEx.relUrlExact.test(r.text),w){this.wte.setValue(r.textBefore+"["+r.text+" ]"+r.textAfter,r.start+r.text.length+2);this.onToggleFormatting("link")}else if(y=r.text.split(" "),n.UrlRegEx.urlExact.test(y[0])||n.UrlRegEx.relUrlExact.test(y[0]))this.wte.setValue(r.textBefore+"["+r.text+"]"+r.textAfter,r.end+2);else{this.wte.setValue(r.textBefore+"[ "+r.text+"]"+r.textAfter,r.start+1);this.onToggleFormatting("link")}}return 0},_build:function(){if(this.baseElement==null){this.txtElement=this.baseEditor.divEditorBlocks.append('<textarea id="EBWPtxt'+this.blockID+'" class="wteParagraph"><\/textarea>').find("#EBWPtxt"+this.blockID).wealthyTextArea({defaultText:this.settings.defaultText,defaultHtml:this.settings.defaultHtml,multiLine:this.settings.multiLine});this.wte=this.txtElement.data("wealthyTextArea");this.wte&&(this.wte.baseEditor=this.baseEditor);this.baseElement=this.txtElement.parentsUntil(".wteWrapper").parent(".wteWrapper").toggleClass("editorBlock",!0);this.baseElement.data("blockID",this.blockID);this.displayElement=this.baseElement.find(".wteDisplay");var n=this;this.defaultSidebarTip={sHeadline:"How to Format Your Text",sBodyTemplate:'<div class="share-tip-section clearfix"><span class="lbl">Bold, Italics, or Link Text<\/span><p><span class="markDown">*<\/span><span style="color:#000;">bold<\/span><span class="markDown">*<\/span> or <span class="markDown">_<\/span><span style="font-style:italic;">italics<\/span><span class="markDown">_<\/span> or <span class="markDown">[<span style="color:#0C743A">http://url.com/<\/span> <span style="color:#06C">link text<\/span>]<\/span><\/p><\/div><div class="share-tip-section clearfix"><span class="lbl">Bullet Lists<\/span><p><span class="markDown">*&nbsp;<\/span>&nbsp;Start a new line with an asterix &amp; a space<\/p><\/div><div class="share-tip-section last clearfix"><span class="lbl">Numbered Lists<\/span><p><span class="markDown">1.&nbsp;<\/span>&nbsp;Start a new line with a number &amp; a period<\/p><\/div>',oForBlock:n};this.oToolbox={}}},_initEvents:function(){var n=this;this.txtElement.on({"focus.whtPostEditor":function(){n.triggerFocusThisBlock()},"keypress.whtPostEditor":function(t){return n.onKeyPress(t)},"keydown.whtPostEditor":function(t){return n.onKeyDown(t)}})},_wrapNeghiboringOpenersAndClosers:function(n,t,i){var r=this._getSelectionCoverageBetween(n,t,i);return r.isContainedInRange||r.startCharsBeforeRange!=1||r.endCharsAfterRange!=1||(this.wte.setSelection(n.start-1,n.end+1,!0),n=this.getSelectionRange()),n.text.length>1&&String(n.text.charAt(n.text.length-1)).in(" ","\n")&&!String(n.text.charAt(n.text.length-2)).in(" ","\n")&&(this.wte.setSelection(n.start,n.end-1,!0),n=this.getSelectionRange()),n.text.length>1&&String(n.text.charAt(0)).in(" ","\n")&&!String(n.text.charAt(1)).in(" ","\n")&&(this.wte.setSelection(n.start+1,n.end,!0),n=this.getSelectionRange()),n},_isSelectionInWord:function(t,i,r){var s,u,h;if(r=r||!1,s=!t.textBefore.match(r?/(^|\s|\n|[,\"\<\>\\])$/:/(^|\s|\n|[\.,\!\?\(\)\[\]\{\}\:\"\<\>\\\/\;])$/)&&!t.textAfter.match(r?/^($|\s|\n|[,\"\<\>\\])/:/^($|\s|\n|[\.,\!\?\(\)\[\]\{\}\:\"\<\>\\\/\;])/),s&&i){var f=!1,e=0,o=0;for(u=t.textBefore.length-1;u>=0;u--)if(String(t.textBefore.charAt(u)).match(r?/(\s|\n|[,\"\<\>\\])/:/(\s|\n|[\.,\!\?\(\)\[\]\{\}\:\"\<\>\\\/\;])/)){e=t.textBefore.length-u-1;f=!0;break}for(f||(e=t.textBefore.length),f=!1,u=0;u<t.textAfter.length;u++)if(String(t.textAfter.charAt(u)).match(r?/(\s|\n|[,\"\<\>\\])/:/(\s|\n|[\.,\!\?\(\)\[\]\{\}\:\"\<\>\\\/\;])/)){o=u;f=!0;break}if(f||(o=t.textAfter.length),r&&(h=t.textBefore.substr(t.textBefore.length-e,e)+t.text+t.textAfter.substring(0,o),!(n.UrlRegEx.urlExact.test(h)||n.UrlRegEx.relUrlExact.test(h))))return!1;this.wte.setValue(t.textBefore+t.text+t.textAfter,t.start-e,t.end+o)}return s},_getSelectionCoverageBetween:function(n,t,i){i=i||t;var s=n.textAfter.indexOf("\n"),h=n.textBefore.lastIndexOf("\n"),u=n.textBefore.lastIndexOf(t),c=n.textBefore.lastIndexOf(i),o=n.textAfter.indexOf(t),f=n.textAfter.indexOf(i),r=n.text.indexOf(t),e=n.text.indexOf(i,t==i&&n.text.length>0?n.text.length>r+1?r+1:1:0);e==r&&(e=-1);s>-1&&(s<o&&(o=-1),s<f&&(f=-1));h>-1&&(h>u&&(u=-1),h>c&&(c=-1));var l=n.text.length>0&&r==0&&e==n.text.length-1&&(t!=i||e>r),a=u>-1&&u>=c?n.textBefore.length-u:0,v=f>-1&&(o==-1||f<=o)?f+1:0;return{isContainedInRange:l,isWrappedInRange:l||a>0&&v>0,startCharsBeforeRange:a,endCharsAfterRange:v,firstOpenInRange:r,firstCloseInRange:e}},_toggleFormattingForWrapperChar:function(n){var i=this._wrapNeghiboringOpenersAndClosers(this.wte.getLastSelectionRange(),"[","]"),u=this._getSelectionCoverageBetween(i,"[","]");!u.isContainedInRange&&u.isWrappedInRange&&this.wte.setValue(i.textBefore+i.text+i.textAfter,i.start-u.startCharsBeforeRange,i.end+u.endCharsAfterRange);var t=this._wrapNeghiboringOpenersAndClosers(this.wte.getLastSelectionRange(),n,n),f=this._getSelectionCoverageBetween(t,n,n),v=new RegExp("\\"+n),r=new RegExp("\\"+n,"g");if(!(t.text.indexOf("\n")>-1))if(f.isContainedInRange)this.wte.setValue(t.textBefore+t.text.substring(1,t.text.length-1)+t.textAfter,t.start,t.end-2);else if(f.firstOpenInRange>-1&&f.firstCloseInRange==-1)this.wte.setValue(t.textBefore+n+t.text.replace(v,"")+t.textAfter,t.start+1,t.end);else if((t.text.match(r)||[]).length%2==0){if(this._isSelectionInWord(t,!0)){this._toggleFormattingForWrapperChar(n);return}var s=(t.text.match(r)||[]).length,e=t.textBefore.length>0&&t.textBefore.charAt(t.textBefore.length-1)==n,h=t.textAfter.length>0&&t.textAfter.charAt(0)==n;e&&(s+=2);h&&s++;t.text==""?e?this.wte.setValue(t.textBefore+t.text+t.textAfter,t.start-1):h?this.wte.setValue(t.textBefore+t.text+t.textAfter,t.start+1):this.wte.setValue(t.textBefore+n+t.text+n+t.textAfter,t.start+1):this.wte.setValue((e?t.textBefore.substring(0,t.textBefore.length-1):t.textBefore+n)+t.text.replace(r,"")+(h?t.textAfter.substring(1,t.textAfter.length-1):n+t.textAfter),t.start-(e?1:0),t.end-(s-2))}else if(f.isWrappedInRange){var c=t.textBefore.split("\n"),o=c[c.length-1],l=((n=="*"&&o.indexOf("* ")==0?o.substring(2,o.length-2):o).match(r)||[]).length%2==0,a=(t.textAfter.split("\n")[0].match(r)||[]).length%2==0;l==a?this.wte.setValue(t.textBefore+(t.textBefore.charAt(t.textBefore.length-1)==n?"":n)+t.text+n+t.afterText,t.start,t.end+2):!l&&a&&this.wte.setValue(t.textBefore+t.text+n+t.afterText,t.start,t.end+1)}}})}(window.WHT=window.WHT||{},jQuery),function(n,t){var i=/(([^.]*)\.(?:[^.]{2,3}|asia|info|jobs|mobi|arpa|name)(?:\.[^.]{2,3})?)(?:\/(?:.*))?$/i;n.EditorBlock.BlockTypes.EBWealthyBlockquote=n.EditorBlock.BlockTypes.EBWealthyParagraph.extend({EB_TYPE:"EBWealthyBlockquote",CAN_MERGE_WITH_TWIN:!1,CAN_HAVE_TWIN_NEIGHBOR:!1,CAN_SPLIT_BLOCKS:!0,CAN_BE_SPLIT:!1,INTERCEPT_MENU_BUTTONS:[],FOLLOW_WITH_BLOCK_TYPE:"EBWealthyParagraph",settings:{attachToolbox:!1,defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Click to paste the quote...<\/span>',multiLine:!0,maxLength:0,quoteType:n.EditorBlock.QT_BLOCKQUOTE,citeUrl:"",citeName:"",followWithBlockOptions:{defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Click to start a new paragraph...<\/span>'}},toolboxOverrides:{buttons:[{action:"quote",visible:!1},{action:"image",visible:!1},{action:"video",visible:!1},{action:"step",visible:!1},{action:"headline",visible:!1},{action:"list-ul",visible:!1},{action:"list-ol",visible:!1},{action:"custom",visible:!0,enabled:!1,custom:"_getToolboxQuoteTypeSelector"}]},minimumHeights:[22,154],init:function(i,r){this.blockID=n.EditorBlock.BlockID++;this.self=this;this.baseEditor=i;this.txtElement=null;this.baseElement=null;this.wte=null;var u={};t.extend(!0,u,this.settings);r&&t.extend(!0,u,r);this.settings=u;this._build();this._initEvents();this.settings.xml&&this.xml(this.settings.xml)},split:function(){var n=this,t=n.getSelectionRange(),i=n.baseEditor.attachBlockWithDefaultOptions("EBWealthyBlockquote",!0,!0,n.settings);n.wte.setValue(t.textBefore);n.wte.cleanup();i.wte.setValue(t.textAfter);i.wte.cleanup()},setValueFromWTEParsedHtml:function(n){if(this.wte.setValue(n.value),!n.citeUrl||(this.settings.citeUrl=n.citeUrl),!n.citeName||(this.settings.citeName=n.citeName),this.txtCreditUrl.val(this.settings.citeUrl),this.txtCreditName.val(this.settings.citeName),this.onCreditUrlChange(),this.onCreditUrlBlur(),!!n.quoteType)this.onQuoteTypeChange(n.quoteType)},onTabPress:function(t,i){switch(t){case"txtElement":if(!i)return this.txtCreditName[0].focus(),!1;break;case"txtCreditName":return i?this.txtElement[0].focus():this.txtCreditUrl[0].focus(),!1;case"txtCreditUrl":if(i)this.txtCreditName[0].focus();else for(var r=this.baseEditor.getNextBlock(this),u=10;r!=null&&r.blockID!=this.blockID&&--u>0;)if(r.IS_TEXT){r.setSelection(n.EditorBlock.SELECT_START);break}else r=this.baseEditor.getNextBlock(r);return!1}return!0},onCreditNameChange:function(){this.settings.citeName=this.txtCreditName.val().trim()},onCreditUrlChange:function(){var t=this.txtCreditUrl.val().trim();(this._lastCreditUrl!==t||t!==this.settings.citeUrl)&&(this._lastCreditUrl=t,t==""?(this.txtCreditUrl.css("color",""),this.settings.citeUrl=""):n.UrlRegEx.urlExact.test(t)?(this.txtCreditUrl.css("color","#0C743A"),this.settings.citeUrl=t):(this.txtCreditUrl.css("color","#E31414"),this.settings.citeUrl=""))},onCreditUrlBlur:function(){var t=this.txtCreditUrl.val().trim();t!==""&&n.UrlRegEx.urlExact.test(t)&&t.indexOf("http")!=0&&this.txtCreditUrl.val(n.Scheme.correctNative("http://"+t))},onQuoteTypeChange:function(i){if(i!==this.settings.quoteType){this.settings.quoteType=i;this.$selectQuoteType.val(String(i));this.baseElement.toggleClass("right",!1).toggleClass("left",!1).toggleClass("pullquote",!1).toggleClass("center",!1);var r=t(window);switch(this.settings.quoteType){case n.EditorBlock.QT_PULLQUOTE:this.baseElement.toggleClass("pullquote",!0).toggleClass("center",!0);break;case n.EditorBlock.QT_PULLQUOTE_LEFT:this.baseElement.toggleClass("pullquote",!0).toggleClass("left",r.width()>=768);break;case n.EditorBlock.QT_PULLQUOTE_RIGHT:this.baseElement.toggleClass("pullquote",!0).toggleClass("right",r.width()>=768)}if(this.wte){this.wte.copyStyles();this.wte.onWinResize(null,!0)}}},splittingOtherBlock:function(n){if(!n)return!1;var t=n.getSelectionRange();t.text&&t.text!==""&&this.wte.setValue((this.settings&&this.settings.defaultText&&this.settings.defaultText!==""?this.settings.defaultText:"")+t.text)},xml:function(){var u=t.trim(this.wte.html()),r,f,e;if(u=="")return"";r="";this.settings.citeName?r=this.settings.citeUrl?'\n <footer>— <a href="'+this.settings.citeUrl.trim().htmlEscape()+'" target="_blank" rel="nofollow">'+this.settings.citeName.trim().htmlEscape()+"<\/a><\/footer>":"\n <footer>— "+this.settings.citeName.trim().htmlEscape()+"<\/footer>":!!this.settings.citeUrl&&i.test(this.settings.citeUrl)&&(r='\n <footer>— <a href="'+this.settings.citeUrl.trim().htmlEscape()+'" target="_blank" rel="nofollow">'+this.settings.citeUrl.match(i)[2].toLowerCase().htmlEscape()+"<\/a><\/footer>");f="<blockquote"+(!this.settings.citeUrl?"":' cite="'+this.settings.citeUrl.trim().htmlEscape()+'"')+"{0}>";e="<\/blockquote>";switch(this.settings.quoteType){case n.EditorBlock.QT_PULLQUOTE:case n.EditorBlock.QT_PULLQUOTE_LEFT:case n.EditorBlock.QT_PULLQUOTE_RIGHT:u="\n <aside>"+f.format(' class="{0}"'.format((this.settings.quoteType==n.EditorBlock.QT_PULLQUOTE_LEFT?"left":this.settings.quoteType==n.EditorBlock.QT_PULLQUOTE?"center":"right")+(r!=""?" has-citation":"")))+u+r+e+"<\/aside> \n";break;case n.EditorBlock.QT_BLOCKQUOTE:default:u="\n "+f.format(' class="{0}"'.format(r!=""?"blockquote has-citation":"blockquote"))+u+r+e+" \n"}return'<DocPart PartType="TextBlock" id="docPartTxt'+this.blockID+'"><HtmlText>'+u+"<\/HtmlText><\/DocPart>"},_build:function(){if(this.baseElement==null&&(this.txtElement=this.baseEditor.divEditorBlocks.append('<textarea id="EBWBQtxt'+this.blockID+'" class="wteBlockquote"><\/textarea>').find("#EBWBQtxt"+this.blockID).wealthyTextArea({defaultText:this.settings.defaultText,defaultHtml:this.settings.defaultHtml,multiLine:this.settings.multiLine,maxLength:this.settings.maxLength}),this.wte=this.txtElement.data("wealthyTextArea"),this.wte&&(this.wte.baseEditor=this.baseEditor),this.baseElement=this.txtElement.parentsUntil(".wteWrapper").parent(".wteWrapper").toggleClass("editorBlock",!0).toggleClass("wteBlockquoteWrapper",!0),this.baseElement.data("blockID",this.blockID),this.baseElement.append('<div class="wteCredit"><\/div>').find(".wteCredit").append("—").append('<input id="EBWBQCreditName'+this.blockID+'" type="text" placeholder="Source Name (optional)" tabindex="-1" spellcheck="false" autocomplete="off" class="lp-search-hack"/>').append('<input id="EBWBQCreditUrl'+this.blockID+'" type="text" placeholder="Source Url (optional)" tabindex="-1" spellcheck="false" autocomplete="off" class="lp-search-hack"/>'),this.txtCreditUrl=t("#EBWBQCreditUrl"+this.blockID),this.txtCreditName=t("#EBWBQCreditName"+this.blockID),this.wte))this.wte.onWinResize(null,!0)},_initEvents:function(){var n=this;n.txtElement.on({"keydown.whtPostEditor":function(t){return(t.keyCode||t.which)==9?n.onTabPress("txtElement",t.shiftKey):!0}});n._super();n.txtCreditUrl.on({"focus.whtPostEditor":function(){n.baseEditor.setFocusedBlock(n);setTimeout(function(){n.txtCreditUrl[0].focus()},1)},"blur.whtPostEditor":function(t){n.onCreditUrlBlur(t)},"keypress.whtPostEditor":function(t){return n.onCreditUrlChange(t)},"change.whtPostEditor":function(t){return n.onCreditUrlChange(t)},"input.whtPostEditor":function(t){return n.onCreditUrlChange(t)},"keydown.whtPostEditor":function(t){return(t.keyCode||t.which)==9?n.onTabPress("txtCreditUrl",t.shiftKey):!0}});n.txtCreditName.on({"focus.whtPostEditor":function(){n.baseEditor.setFocusedBlock(n);setTimeout(function(){n.txtCreditName[0].focus()},1)},"keypress.whtPostEditor":function(t){return n.onCreditNameChange(t)},"change.whtPostEditor":function(t){return n.onCreditNameChange(t)},"input.whtPostEditor":function(t){return n.onCreditNameChange(t)},"keydown.whtPostEditor":function(t){return(t.keyCode||t.which)==9?n.onTabPress("txtCreditName",t.shiftKey):!0}})},_getToolboxQuoteTypeSelector:function(){if(!n.loggedInUser.IsStaff)return"";var u=this,r=t("<select><\/select>"),i=r[0];i.options[i.length]=new Option("Blockquote",n.EditorBlock.QT_BLOCKQUOTE);i.options[i.length]=new Option("Centered Pull Quote",n.EditorBlock.QT_PULLQUOTE);i.options[i.length]=new Option("Right Pull Quote",n.EditorBlock.QT_PULLQUOTE_RIGHT);i.options[i.length]=new Option("Left Pull Quote",n.EditorBlock.QT_PULLQUOTE_LEFT);r.val(String(this.settings.quoteType));r.on("change",function(){u.onQuoteTypeChange(Number(r.val()))});return this.$selectQuoteType=null,this.$selectQuoteType=r,t("<span><\/span>").append(r)}});n.EditorBlock.QT_BLOCKQUOTE=0;n.EditorBlock.QT_PULLQUOTE=1;n.EditorBlock.QT_PULLQUOTE_RIGHT=2;n.EditorBlock.QT_PULLQUOTE_LEFT=3}(window.WHT=window.WHT||{},jQuery),function(n,t){n.EditorBlock.BlockTypes.EBWealthyHeadline=n.EditorBlock.BlockTypes.EBWealthyParagraph.extend({EB_TYPE:"EBWealthyHeadline",CAN_MERGE_WITH_TWIN:!1,CAN_HAVE_TWIN_NEIGHBOR:!1,CAN_SPLIT_BLOCKS:!0,CAN_BE_SPLIT:!1,INTERCEPT_MENU_BUTTONS:["MenuStep","MenuHeadline"],FOLLOW_WITH_BLOCK_TYPE:"EBWealthyParagraph",settings:{attachToolbox:!1,defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Type a Headline...<\/span>',multiLine:!1,maxLength:120,autoCapitalize:!0,followWithBlockOptions:{defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Click to start a new paragraph...<\/span>'}},toolboxOverrides:{buttons:[{action:"bold",visible:!1},{action:"italic",visible:!1},{action:"link",visible:!1},{action:"quote",visible:!1},{action:"image",enabled:!1},{action:"video",enabled:!1},{action:"step",enabled:!1},{action:"headline",enabled:!1},{action:"list-ul",visible:!1},{action:"list-ol",visible:!1},{action:"custom",visible:!0,enabled:!1,custom:"_getHeadlineAutoCapitalizeToggle"}]},minimumHeights:null,xml:function(n){n&&(n=t.trim(n),n.indexOf("<DocPart ")==0||this.wte.setValue(n));var i=t.trim(this.wte.html());return i==""?"":'<DocPart PartType="TextBlock" id="docPartTxt'+this.blockID+'"><HtmlText><h1'+(this.settings.autoCapitalize?"":' class="no-auto-capitalize"')+">"+i+"<\/h1><\/HtmlText><\/DocPart>"},onLostFocus:function(){this._super();this._fixCapitalizationIfNeeded()},onAutoCapitalizeChange:function(n){this.settings.autoCapitalize!==!!n&&(this.settings.autoCapitalize=!!n,this.settings.autoCapitalize?this._fixCapitalizationIfNeeded():this.wte.getValue(!0)===this._lastCorrectedValue&&this.wte.setValue(this._lastPreCorrectedValue))},_build:function(){this.baseElement==null&&(this.txtElement=this.baseEditor.divEditorBlocks.append('<textarea id="EBWHtxt'+this.blockID+'" class="wteHeadline"><\/textarea>').find("#EBWHtxt"+this.blockID).wealthyTextArea({defaultText:this.settings.defaultText,defaultHtml:this.settings.defaultHtml,multiLine:this.settings.multiLine,maxLength:this.settings.maxLength}),this.wte=this.txtElement.data("wealthyTextArea"),this.wte&&(this.wte.baseEditor=this.baseEditor),this.baseElement=this.txtElement.parentsUntil(".wteWrapper").parent(".wteWrapper").toggleClass("editorBlock",!0),this.baseElement.data("blockID",this.blockID))},_fixCapitalizationIfNeeded:function(){var t,i;this.settings.autoCapitalize&&(t=this.wte.getValue(!0),t!="")&&(i=n.ToTitleCase(t),i!=t&&(this.wte.setValue(i),this._lastPreCorrectedValue=t,this._lastCorrectedValue=i))},_getHeadlineAutoCapitalizeToggle:function(){if(!n.loggedInUser.IsStaff)return"";var f=this,i=t("<select><\/select>"),r=i[0],u=this.EB_TYPE==="EBWealthyHeadline"?"Auto-Capitalize Headline":"Auto-Capitalize";r.options[r.length]=new Option("{0}: ON".format(u),1);r.options[r.length]=new Option("{0}: OFF".format(u),0);i.val(String(this.settings.autoCapitalize?1:0));i.on("change",function(){f.onAutoCapitalizeChange(Number(i.val())===1)});return t("<span><\/span>").append(i)}})}(window.WHT=window.WHT||{},jQuery),function(n,t){n.EditorBlock.BlockTypes.EBWealthySubHeadline=n.EditorBlock.BlockTypes.EBWealthyHeadline.extend({EB_TYPE:"EBWealthySubHeadline",CAN_MERGE_WITH_TWIN:!1,CAN_HAVE_TWIN_NEIGHBOR:!1,CAN_SPLIT_BLOCKS:!0,CAN_BE_SPLIT:!1,INTERCEPT_MENU_BUTTONS:["MenuStep","MenuHeadline"],FOLLOW_WITH_BLOCK_TYPE:"EBWealthyParagraph",settings:{attachToolbox:!1,defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Type a Headline...<\/span>',multiLine:!1,maxLength:80,isStep:!1,stepNum:1,autoCapitalize:!0,followWithBlockOptions:{defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Click to start a new paragraph...<\/span>'}},toolboxOverrides:{buttons:[{action:"bold",visible:!1},{action:"italic",visible:!1},{action:"link",visible:!1},{action:"quote",visible:!1},{action:"image",enabled:!1},{action:"video",enabled:!1},{action:"list-ul",visible:!1},{action:"list-ol",visible:!1},{action:"custom",visible:!0,enabled:!1,custom:"_getHeadlineAutoCapitalizeToggle"}]},minimumHeights:null,init:function(i,r){this.blockID=n.EditorBlock.BlockID++;this.self=this;this.baseEditor=i;this.txtElement=null;this.baseElement=null;this.wte=null;var u={};t.extend(!0,u,this.settings);r&&t.extend(!0,u,r);this.settings=u;this.setStepNum(this.settings.stepNum);this._build();this._initEvents();this.settings.xml&&this.xml(this.settings.xml)},setStepNum:function(n){this.settings.isStep?(this.settings.stepNum=n,this.settings.defaultText="Step "+String(this.settings.stepNum)+": ",this.settings.defaultHtml="Step "+String(this.settings.stepNum)+'<span class="txt-clr-lighter">: Type a Headline for this Step (optional)...<\/span>'):(this.settings.defaultText="",this.settings.defaultHtml='<span class="txt-clr-lighter">Type a Headline...<\/span>');this.wte!=null&&(this.wte.settings.defaultText=this.settings.defaultText,this.wte.settings.defaultHtml=this.settings.defaultHtml,this.settings.isStep&&(this.txtElement[0].value=this.txtElement[0].value.replace(/^Step\s[0-9]+(?::?)(?:\s?)/i,"Step "+String(this.settings.stepNum)+": ")),this.wte._onCursorChange("redraw",{},!0))},splittingOtherBlock:function(n){if(!n)return!1;var t=n.getSelectionRange();this.isStep&&this.baseEditor.updateStepNumbers(!0);t.text&&t.text!==""&&this.wte.setValue((this.settings&&this.settings.defaultText&&this.settings.defaultText!==""?this.settings.defaultText:"")+t.text)},xml:function(){var n=t.trim(this.wte.html());return n==""?"":'<DocPart PartType="TextBlock" id="docPartTxt'+this.blockID+'"><HtmlText><h2 class="'+String(this.settings.isStep?"step":"sectionHeadline")+(this.settings.autoCapitalize?"":" no-auto-capitalize")+'">'+n+"<\/h2><\/HtmlText><\/DocPart>"},_build:function(){this.baseElement==null&&(this.txtElement=this.baseEditor.divEditorBlocks.append('<textarea id="EBWSHtxt'+this.blockID+'" class="wteSubHeadline"><\/textarea>').find("#EBWSHtxt"+this.blockID).wealthyTextArea({defaultText:this.settings.defaultText,defaultHtml:this.settings.defaultHtml,multiLine:this.settings.multiLine,maxLength:this.settings.maxLength}),this.wte=this.txtElement.data("wealthyTextArea"),this.wte&&(this.wte.baseEditor=this.baseEditor),this.baseElement=this.txtElement.parentsUntil(".wteWrapper").parent(".wteWrapper").toggleClass("editorBlock",!0),this.baseElement.data("blockID",this.blockID))}})}(window.WHT=window.WHT||{},jQuery),function(n,t){n.EditorBlock.BlockTypes.EBGallery=n.EditorBlock.extend({EB_TYPE:"EBGallery",IS_TEXT:!1,CAN_MERGE_WITH_TWIN:!0,CAN_HAVE_TWIN_NEIGHBOR:!0,CAN_SET_SELECTION:!1,CAN_SPLIT_BLOCKS:!0,CAN_BE_SPLIT:!1,ATTACHMENT_MODE:0,INTERCEPT_MENU_BUTTONS:["MenuLink","MenuImage"],FOLLOW_WITH_BLOCK_TYPE:"EBWealthyParagraph",settings:{attachToolbox:!1,initMode:"image",followWithBlockOptions:{defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Click to start a new paragraph...<\/span>'}},toolboxOverrides:{buttons:[{action:"bold",visible:!1},{action:"italic",visible:!1},{action:"link",visible:!1},{action:"quote",visible:!1},{action:"list-ul",visible:!1},{action:"list-ol",visible:!1},{action:"headline",visible:!1},{action:"step",visible:!1},{action:"custom",visible:!0,enabled:!1,custom:"_getToolboxButtons"}]},init:function(i,r){this.blockID=n.EditorBlock.BlockID++;this.self=this;this.baseEditor=i;this.baseElement=null;var u={};t.extend(!0,u,this.settings);r&&t.extend(!0,u,r);this.settings=u;this._build();this._initEvents()},xml:function(i){var u,e,r;if(i!=null&&typeof i=="string")try{var f=t(t.parseXML(i)).children().first(),o=f.first()[0].nodeName=="DocPart"?f.first():f,h=Number(o.attr("Layout")||0),s=o.children();for(r=0;r<s.length;r++){u=t(s[r]);switch(u[0].nodeName){case"Video":this.gal.appendGalleryItem(new n.WHTGalleryVideo(u));break;case"Image":this.gal.appendGalleryItem(new n.WHTGalleryImage(u))}}this.gal.setDisplayTemplate(h)}catch(c){console.log("Error Parsing XML for Gallery:\n"+i);console.dir(c)}else i!=null&&typeof i=="object"&&this.gal.addGalleryItems(i.galleryItems,i.layout);if(this.gal.settings.galleryItems.length==0)return"";for(e='<DocPart PartType="Gallery" id="docPartGal'+this.blockID+'" SingleMode="False" Layout="'+this.gal.getActiveLayoutIndex()+'">',r=0;r<this.gal.settings.galleryItems.length;r++)e+=this.gal.settings.galleryItems[r].xml();return e+"<\/DocPart>"},blockIndex:function(){t.error("!!!.blockIndex() not implemented by this EBGallery")},isEmpty:function(){return this.gal.settings.galleryItems.length==0},getSelectionRange:function(){t.error("!!!.getSelectionRange() not implemented by this EBGallery")},setSelection:function(){t.error("!!!.setSelection() not implemented by this EBGallery")},resizeDraggable:function(){if(this.draggable&&this.draggable.length>0&&this.baseEditor.isInited()&&this.gal){var r=this,n=this.gal.getActiveGalleryItem(),t=this.gal.getThumbnailContainer()?this.gal.getThumbnailContainer().height():0,i=this.baseElement.height();window.setTimeout(function(){r.draggable.height(n&&n.galleryItemType==="Image"?i-t:i*.4-t)},10)}},setDisplayTemplate:function(n){this.gal.setDisplayTemplate(n)},onWinResize:function(n){if(this.gal!=null)this.gal.onWinResize(n)},onGotFocus:function(){var n=this;this.baseElement!=null&&this.baseElement[0].focus();n.resizeDraggable()},onLostFocus:function(){this.draggable&&this.draggable.length>0&&this.draggable.height(this.baseElement.height());this._hideMenuButtons()},onMenuButtonClick:function(n,t){if(n=="EBGallery")switch(t.initMode){case"image":case"video":return this.gal.addNewGalleryItem(t.initMode),!1}return!0},onEditMenuClick:function(t,i,r){switch(t){case"gallery-metadata":n.NavBar.createAjaxDialog({URL:"/ajax/getgallerymetadataeditor/",ContainerID:"gallery-meta-data-editor",Title:"Edit {0}Caption{1}".format(r.indexOf("Credit")>-1?"Credit{1} & ":"",this.gal.settings.galleryItems.length>1?"s":""),AdditionalData:{galID:"EBGal"+this.blockID}});break;case"gallery-order":this.gal.settings.galleryItems.length==2?this.gal.reOrderGalleryItem(0,1):this.baseElement.toggleClass("re-order",!0);break;case"gallery-upscale":this.gal.toggleGalleryItemUpScale(i);break;case"gallery-delete":this.gal.settings.galleryItems.length<2?this.gal.removeGalleryItem(0):this.baseElement.toggleClass("delete",!0);break;case"gallery-delete-all":if(!confirm("Are you sure? This will delete everything in this gallery."))return;while(this.gal.settings.galleryItems.length>0)this.gal.removeGalleryItem(0,!0);break;default:var u=this.gal.getActiveLayoutIndex()===0;if(u||String(i)=="NaN"){if(!u)break;i=this.gal.getActiveGalleryItemIndex()}switch(t){case"gallery-item-delete":this.gal.removeGalleryItem(i);break;case"gallery-item-left":this.gal.reOrderGalleryItem(i,i-1);u&&this.gal.setActiveGalleryItem("left",!0);break;case"gallery-item-right":this.gal.reOrderGalleryItem(i,i+1);u&&this.gal.setActiveGalleryItem("right",!0);break;default:n.Alerts.Show("Unhandled Edit Menu Click: "+t+"("+i+")")}}},contentChanged:function(){this.dragClone=null;this.resizeDraggable();this.baseEditor.isInited()&&(this.baseEditor.getFocusedBlock().blockID===this.blockID&&this.initToolbox(),this.baseEditor._renderCoverImageSelector());this._rebuildSettingsMenu()},splittingOtherBlock:function(){},_build:function(){if(this.baseElement==null){this.baseElement=this.baseEditor.divEditorBlocks.append('<div class="editorBlock" id="EBGal'+this.blockID+'"><\/div>').find("#EBGal"+this.blockID);this.baseElement.data("blockID",this.blockID);this.baseElement.whtGallery({initPromptMediaType:this.settings.initMode,editMode:!0,galleryItems:[],baseEditor:this.baseEditor,galleryBlock:this});this.baseElement.prepend('<div class="galDraggableContainer"><div class="galDraggable fl" >&nbsp;<\/div><\/div>');this.gal=this.baseElement.data("whtGallery");this.settingsMenuList=this.baseElement.append('<div class="settings-container"><div class="settings-button"><i class="fa fa-chevron-down"><\/i><\/div><div class="settings-menu"><ul><\/ul><\/div><\/div>').find("ul");this._rebuildSettingsMenu();var t=this;t.innerContent=this.baseElement.find(".contentArea .innerContent");t.itemCaption=this.baseElement.find(".captionText .itemCaption");t.itemsThumbContainer=this.baseElement.find(".itemLinkListContainer .items");t.btnLeft=this.baseElement.find(".nav-leftright .left");t.btnRight=this.baseElement.find(".nav-leftright .right");t.draggable=t.baseElement.find(".galDraggable");n.OnElementReady(this.baseElement)}},_rebuildSettingsMenu:function(){var i='<li><button data-action="{0}">{1}<\/button><\/li>',f,o,s;this.settingsMenuList.empty();var e=this.gal.settings.galleryItems.length>1?"s":"",r=0,u=0;for(f=0;f<this.gal.settings.galleryItems.length;f++)this.gal.settings.galleryItems[f].galleryItemType=="Image"&&r++,this.gal.settings.galleryItems[f].galleryItemType=="Video"&&u++;o=r>0&&u==0?"Image":u>0&&r==0?"Video":"Gallery";this.settingsMenuList.append(i.format("gallery-metadata","Edit {0} {2}Caption{1}...".format(o,e,n.loggedInUser.IsStaff?"Credit{0} &amp; ".format(e):"")));e==="s"&&this.settingsMenuList.append(i.format("gallery-order","{0} {1} Order{2}".format(this.gal.settings.galleryItems.length>2?"Change":"Swap",o,this.gal.settings.galleryItems.length>2?"...":"")));r==1&&u==0&&this.gal.settings.galleryItems[0].isGIPHY&&this.settingsMenuList.append(i.format("gallery-upscale",(this.gal.settings.galleryItems[0].upScale?"Don't ":"")+"Up-Scale GIF"));r==1&&u==0&&this.gal.settings.galleryItems[0].width<532&&this.gal.settings.galleryItems[0].width>=532*.75&&this.settingsMenuList.append(i.format("gallery-upscale",(this.gal.settings.galleryItems[0].upScale?"Don't ":"")+"Up-Scale Image"));this.settingsMenuList.append(i.format("gallery-delete","Delete {0}".format(e=="s"?"Gallery Items...":o)));this.gal.settings.galleryItems.length>1&&this.settingsMenuList.append(i.format("gallery-delete-all","Delete Gallery"));s=this.baseElement.find(".gallery-layout-container figure");s.length==0&&this.baseElement.find(".gallery-layout-container .galContentContainer").length>0&&(s=this.baseElement.find(".gallery-layout-container"));s.each(function(){var i=t(this),n=i.find(".edit-actions").empty();n.length==0&&(n=i.append('<div class="edit-actions"><\/div>').find(".edit-actions"));n.append('<button class="raised-btn re-order center-icon merge-right fl" data-action="gallery-item-left"><i class="fa fa-chevron-left"><\/i><\/button>').append('<button class="raised-btn re-order center-icon merge-left mfl" data-action="gallery-item-right"><i class="fa fa-chevron-right"><\/i><\/button>').append('<button class="raised-btn delete center-icon mfl" data-action="gallery-item-delete"><i class="fa fa fa-trash-o"><\/i><\/button>')})},_hideMenuButtons:function(){this.baseElement.toggleClass("re-order",!1).toggleClass("delete",!1)},_getToolboxButtons:function(){return this.gal.getToolboxButtons()},_getDragClone:function(){var n=this;return n.dragClone=n.dragClone||(n.gal?n.gal.getThumbnailContainer()?n.gal.getThumbnailContainer().clone().css({"z-index":"9999"}):t('<div style="z-index: 9999; position: absolute;">'+n.gal.getActiveGalleryItemThumbnail()+"<\/div>"):""),n.dragClone},_initEvents:function(){var n=this;n.draggable.draggable({cursor:"move",cursorAt:{top:-2,left:2},start:function(){n.setFocused(!0);n.baseEditor.isDragging(!0);n.baseEditor.getRoot().find(".wteTextWrap").css("z-index","0")},stop:function(){n.baseEditor.isDragging(!1);n.baseEditor.getRoot().find(".wteTextWrap").css("z-index","2")},helper:function(){return jQuery.browser.msie&&+jQuery.browser.version<10?"<span><\/span>":n._getDragClone()},scrollSensitivity:40});n.baseElement.on({"focus.whtPostEditor":function(){n.triggerFocusThisBlock()},"click.whtPostEditor":function(){n&&n.baseEditor&&n.baseEditor.onFocusThisBlock&&n.triggerFocusThisBlock()},"contentChanged.whtPostEditor":function(t){n.contentChanged(t);n.triggerUpdateDefaultTip()},"galleryEmptied.whtPostEditor":function(){n.triggerDeleteBlock()},"galleryLoaded.whtPostEditor":function(){n.draggable&&n.draggable.length>0&&(n.draggable.height(n.baseElement.height()),n.resizeDraggable(),n._getDragClone());n._rebuildSettingsMenu()},"galleryItemChanged.whtPostEditor":function(){n.resizeDraggable()}});n.settingsMenuList.on("click.whtPostEditor","button",function(i){i.preventDefault();var r=t(i.target);r.is("button")||(r=r.closest("button"));n.onEditMenuClick(r.data("action"),null,r.text())});n.baseElement.on("click.whtPostEditor",".edit-actions button",function(i){i.preventDefault();var r=t(i.target);r.is("button")||(r=r.closest("button"));n.onEditMenuClick(r.data("action"),Number(r.closest("figure, .gallery-layout-container").data("index")))});n.baseElement.on("click.whtPostEditor",".settings-button",function(){n._hideMenuButtons()});n.baseElement.on("hover",".gallery-delete-btn",function(n){var i=t(this);n.type==="mouseenter"?i.addClass("silver rnd"):i.removeClass("silver")});n.baseElement.on("click",".gallery-delete-btn",function(){if(n.setFocused(!0),confirm("Are you sure you want to delete this gallery?"))for(var t=n.gal.settings.galleryItems.length-1;t>-1;t--)n.gal.removeGalleryItem(t,!0)})}})}(window.WHT=window.WHT||{},jQuery),function(){function n(n){for(var i={},r=n.split(","),t=0;t<r.length;t++)i[r[t]]=!0;return i}var i=/^<([-A-Za-z0-9_]+)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,r=/^<\/([-A-Za-z0-9_]+)[^>]*>/,e=/([-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,u=/(([^.]*)\.(?:[^.]{2,3}|asia|info|jobs|mobi|arpa|name)(?:\.[^.]{2,3})?)(?:\/(?:.*))?$/i,o=n("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed,canvas"),f=n("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul,article,header,aside,hgroup,output,section,figure,figcaption,footer,progress,video"),s=n("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var,mark,audio,meter,nav,details,command,source,datalist,summary,time"),h=n("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),c=n("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),l=n("script,style"),t=this.HTMLParser=function(n,t){function k(n,i,r,l){if(i=i.toLowerCase(),f[i])while(u.last()&&s[u.last()])p("",u.last());if(h[i]&&u.last()==i&&p("",i),l=o[i]||!!l,l||u.push(i),t.start){var a=[];r.replace(e,function(n,t){var i=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:c[t]?t:"";a.push({name:t,value:i,escaped:i.replace(/(^|[^\\])"/g,'$1\\"')})});t.start&&t.start(i,a,l)}}function p(n,i){var r,f;if(i){for(r=u.length-1;r>=0;r--)if(u[r]==i)break}else r=0;if(r>=0){for(f=u.length-1;f>=r;f--)t.end&&t.end(u[f]);u.length=r}}var a,y,v,u=[],w=n,b;for(u.last=function(){return this[this.length-1]};n;){if(y=!0,u.last()&&l[u.last()]?(n=n.replace(new RegExp("(.*)<\/"+u.last()+"[^>]*>"),function(n,i){return i=i.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)]]>/g,"$1"),t.chars&&t.chars(i),""}),p("",u.last())):(n.indexOf("<!--")==0?(a=n.indexOf("-->"),a>=0&&(t.comment&&t.comment(n.substring(4,a)),n=n.substring(a+3),y=!1)):n.indexOf("<\/")==0?(v=n.match(r),v&&(n=n.substring(v[0].length),v[0].replace(r,p),y=!1)):n.indexOf("<")==0&&(v=n.match(i),v&&(n=n.substring(v[0].length),v[0].replace(i,k),y=!1)),y&&(a=n.indexOf("<"),b=a<0?n:n.substring(0,a),n=a<0?"":n.substring(a),t.chars&&t.chars(b))),n==w)throw"Parse Error: "+n;w=n}p()};this.HTMLtoXML=function(n){var i="";return t(n,{start:function(n,t,r){i+="<"+n;for(var u=0;u<t.length;u++)i+=" "+t[u].name+'="'+t[u].escaped+'"';i+=(r?"/":"")+">"},end:function(n){i+="<\/"+n+">"},chars:function(n){i+=n},comment:function(n){i+="<!--"+n+"-->"}}),i};this.HTMLtoDOM=function(i,r){var f=n("html,head,body,title"),o={link:"head",base:"head"},e,h,s,u;if(r?r=r.ownerDocument||r.getOwnerDocument&&r.getOwnerDocument()||r:typeof DOMDocument!="undefined"?r=new DOMDocument:typeof document!="undefined"&&document.implementation&&document.implementation.createDocument?r=document.implementation.createDocument("","",null):typeof ActiveX!="undefined"&&(r=new ActiveXObject("Msxml.DOMDocument")),e=[],h=r.documentElement||r.getDocumentElement&&r.getDocumentElement(),!h&&r.createElement&&function(){var n=r.createElement("html"),t=r.createElement("head");t.appendChild(r.createElement("title"));n.appendChild(t);n.appendChild(r.createElement("body"));r.appendChild(n)}(),r.getElementsByTagName)for(s in f)f[s]=r.getElementsByTagName(s)[0];return u=f.body,t(i,{start:function(n,t,i){var s,h;if(f[n]){u=f[n];return}s=r.createElement(n);for(h in t)s.setAttribute(t[h].name,t[h].value);o[n]&&typeof f[o[n]]!="boolean"?f[o[n]].appendChild(s):u&&u.appendChild&&u.appendChild(s);i||(e.push(s),u=s)},end:function(){e.length-=1;u=e[e.length-1]},chars:function(n){u.appendChild(r.createTextNode(n))},comment:function(){}}),r};this.HTMLtoWTE=function(n){var r=[{type:"EBWealthyParagraph",value:""}],i=0,o=!1,h=!1,l=!1,s=!1,a=!1,v=!1,p=!1,k=!1,w=!1,d=!1,g=!1,nt=!1,c=!1,tt=1,y=null,rt="",it="",e,b;for(t(n,{start:function(n,t,u){var e,b,ut,ft,et,f;if(!v){it="";switch(n.toLowerCase()){case"br":r[i].value+="\n";break;case"b":case"strong":if(s||h||o)break;h=!0;r[i].value+="*";break;case"i":case"em":if(a||l||o)break;l=!0;r[i].value+="_";break;case"a":if(o||c)break;o=!0;r[i].value+="[";for(f in t)t[f].name=="href"&&(r[i].value+=it=t[f].value.replace(/&quot;/g,'"').replace(/&amp;/g,"&"));r[i].value+=" ";break;case"span":for(f in t)t[f].name=="class"&&t[f].value.indexOf("ulText")>-1&&!h&&!o&&!s?(s=!0,r[i].value+="*"):t[f].name=="style"&&(e=t[f].value.toLowerCase().replace(/\s/g,""),!(e.indexOf("font-weight:bold")>-1||e.indexOf("text-decoration:underline")>-1)||h||o||s||(s=!0,r[i].value+="*"),e.indexOf("font-style:italic")>-1&&!l&&!o&&!a&&(a=!0,r[i].value+="_"));break;case"li":d=!0;r[i].value+=rt=w?String(tt++)+". ":"* ";break;case"ul":k=!0;break;case"ol":w=!0;tt=1;for(f in t)t[f].name=="start"&&t[f].value.match(/^[0-9]+$/)&&(tt=Number(t[f].value));break;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":y=null;r.push({type:"EBWealthySubHeadline",value:"",autoCapitalize:!0});i++;v=!0;for(f in t)if(t[f].name=="class"){b=t[f].value.match(/\bstepNum([0-9]+)\b/i);b&&b.index>-1&&(y=Number(b[1]));t[f].value.match(/\bno\-auto\-capitalize\b/i)&&(r[i].autoCapitalize=!1);break}break;case"img":ut="";ft=!1;for(f in t)t[f].name=="src"?ut=t[f].value:t[f].name=="class"&&(t[f].value.indexOf("imgRight")>-1||t[f].value.indexOf("imgLeft")>-1)&&(ft=!0);ut!=""&&(et=new WHT.WHTGalleryImage(ut,0,0),r.push({type:"EBGallery",value:'<DocPart PartType="Gallery" SingleMode="False" Layout="0">'+et.xml()+"<\/DocPart>",swapWithNext:ft}),i++);p=!u;p||(r.push({type:"EBWealthyParagraph",value:""}),i++);break;case"aside":g=!0;break;case"blockquote":nt=!0;r.push({type:"EBWealthyBlockquote",value:"",citeUrl:"",citeName:"",quoteType:WHT.EditorBlock.QT_BLOCKQUOTE});i++;g&&(r[i].quoteType=WHT.EditorBlock.QT_PULLQUOTE_RIGHT);for(f in t)t[f].name=="class"?t[f].value.indexOf("left")>-1?r[i].quoteType=WHT.EditorBlock.QT_PULLQUOTE_LEFT:t[f].value.indexOf("center")>-1&&(r[i].quoteType=WHT.EditorBlock.QT_PULLQUOTE):t[f].name=="cite"&&(r[i].citeUrl=t[f].value);break;case"footer":nt&&(c=!0)}}},end:function(n){if(v)switch(n.toLowerCase()){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":r[i].value=$.trim(r[i].value);!/^Step\s[0-9]+(?::?)(?:\s?)/i.test(r[i].value)&&y!=null&&y>0&&(r[i].value="Step "+y+": "+r[i].value);/^Step\s[0-9]+(?::?)(?:\s?)/i.test(r[i].value)&&(r[i].type="EBWealthySubHeadlineStep");r.push({type:"EBWealthyParagraph",value:""});i++;v=!1}else if(p)switch(n.toLowerCase()){case"img":r.push({type:"EBWealthyParagraph",value:""});i++;p=!1}else if(c)switch(n.toLowerCase()){case"footer":c=!1}else switch(n.toLowerCase()){case"p":r[i].value+="\n\n";break;case"b":case"strong":if(!h)break;h=!1;r[i].value+="*";break;case"i":case"em":if(!l)break;l=!1;r[i].value+="_";break;case"a":if(!o)break;o=!1;r[i].value+="]";break;case"span":a&&(a=!1,r[i].value+="_");s&&(s=!1,r[i].value+="*");break;case"li":r[i].value+="\n";d=!1;break;case"ol":r[i].value+="\n";w=!1;break;case"ul":r[i].value+="\n";k=!1;break;case"aside":g=!1;break;case"blockquote":u.test(r[i].citeUrl)&&r[i].citeUrl.match(u)[2].toLowerCase()===r[i].citeName&&(r[i].citeName="");r.push({type:"EBWealthyParagraph",value:""});i++;nt=!1;break;default:f[n.toLowerCase()]&&r[i].value.length>0&&r[i].value.charAt(r[i].value.length-1)!="\n"&&(r[i].value+="\n")}},chars:function(n){var t,u;if(n!=""&&(!(w||k)||d)){if(t=document.createElement("div"),t.innerHTML=n,o||v||c){if(n=$(t).text().replace(/\s+/g," "),o)n=n===it?"":n.replace(/\[/g,"(").replace(/\]/g,")");else if(c){u=n.indexOf("—");u>-1&&(n=n.substring(u+1));n=n.trim();r[i].citeName+=n;return}}else n=$(t).text().replace(/\s+/g," ").replace(/_/g,"__").replace(/\*/g,"**").replace(/\[/g,"[[").replace(/\]/g,"]]");r[i].value.charAt(r[i].value.length-1)==" "&&n.charAt(0)==" "&&(n=n.substring(1));r[i].value+=n}}}),e=[],i=0;i<r.length;i++)r[i].value=$.trim(r[i].value),(i==0||r[i].value!="")&&(i>0&&r[i].type=="EBWealthyParagraph"&&e[e.length-1].swapWithNext?(e[e.length-1].swapWithNext=!1,e.length>1&&e[e.length-2].type=="EBWealthyParagraph"?(b=r[i].value.indexOf("\n"),b>-1?(e[e.length-2].value+=" "+r[i].value.substring(0,b),r[i].value=$.trim(r[i].value.substring(b)),r[i].value!=""&&e.push(r[i])):e[e.length-2].value+=" "+r[i].value):(e.push(e[e.length-1]),e[e.length-2]=r[i])):e.push(r[i]));return e}}(),function(n,t){n.EditorBlock.BlockTypes.EBLink=n.EditorBlock.extend({EB_TYPE:"EBLink",IS_TEXT:!0,CAN_SET_SELECTION:!1,CAN_MERGE_WITH_TWIN:!1,CAN_HAVE_TWIN_NEIGHBOR:!0,CAN_SPLIT:!1,ATTACHMENT_MODE:n.EditorBlock.AM_APPEND_BOTTOM,INTERCEPT_MENU_BUTTONS:[],FOLLOW_WITH_BLOCK_TYPE:"",settings:{defaultText:"",defaultHtml:'<span class="txt-clr-lighter">Click enter a link...<\/span>',multiLine:!1},minimumHeights:[22,154],init:function(i,r){this.blockID=n.EditorBlock.BlockID++;this.self=this;this.baseEditor=i;this.txtElement=null;this.baseElement=null;this.rxMatchURLExact=/^(?:(?:https?|ftp):\/\/)?(?:[A-Z0-9](?:[-A-Z0-9.]*))(?:\.[a-z]{2,4}(?::[0-9]+)?)((?:\/|\?|#)(?:(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#\/%=~_|$?!:,.])*)(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[A-Z0-9+&@#\/%=~_|$?!:,.])$|(?:\/|\?|#)$|$)/i;this.errorContainer={};this.attachmentInfo={URL:"",Title:"",Description:"",Images:[],SelectedImage:""};var u={};t.extend(!0,u,this.settings);r&&t.extend(!0,u,r);this.settings=u;this._build();this._initEvents();this.settings.xml&&this.xml(this.settings.xml)},split:function(){t.error("!!!.split() not implemented by this EBWealthyParagraph")},setHtml:function(){},onMenuButtonClick:function(){return!1},xml:function(i){var r,u,o,f,e;if(i!=null){if(r={},typeof i=="string"){if(i=t.trim(i),i.indexOf("<DocPart")==0||i.indexOf("<Link")==0||!self.rxMatchURLExact.text(i))try{u=t(t.parseXML(i).firstChild);console.dir(u);o=u.first()[0].nodeName=="DocPart"?u.first():u;sHtml=u.first()[0].nodeName=="Link"?u.first().xml():u.xml()}catch(s){console.log("Error Parsing XML for EBLink:\n"+i);console.dir(s)}}else if(typeof i=="object")if(i.type=="attachedLinkBlock")r.URL=i.url||"",r.Title=i.title||"",r.Description=i.description||"",i.imgsrc?(f=new n.ImgUrl(i.imgsrc,"w240"),console.dir(f),f.isValid&&f.toString()!=""?(r.Images=[f.toString()],console.dir(r.Images)):r.Images=[i.imgsrc]):r.Images=[];else if(i.URL&&i.Title&&(r.URL=i.URL||"",r.Title=i.Title||"",r.Description=i.Description||"",r.Images=[],i.Images&&i.Images.length>0))for(e=0;e<i.Images.length;e++)r.Images.push(i.Images[e]);r.URL&&r.Title&&this._initLinkPreview(r)}return this.txtTitle&&this.attachmentInfo.URL?'<DocPart PartType="AttachedLink" id="docPartTxt'+this.blockID+'" ><Link href="'+encodeURIComponent(this.attachmentInfo.URL)+'" title="'+encodeURIComponent(n.EncodeEntities(this.txtTitle.val().trim()))+'" imgsrc="'+encodeURIComponent(this.attachmentInfo.SelectedImage)+'" description="'+encodeURIComponent(n.EncodeEntities(this.txtDescription.val().trim()))+'" /><\/DocPart>':""},blockIndex:function(){t.error("!!!.blockIndex() not implemented by this EBWealthyParagraph")},isEmpty:function(){return this.attachmentInfo.URL==""},getSelectionRange:function(){t.error("!!!.getSelectionRange() not implemented by this EBWealthyParagraph")},setSelection:function(){t.error("!!!.setSelection() not implemented by this EBLink")},onGotFocus:function(){this.txtElement[0].focus()},onLostFocus:function(){},onKeyPress:function(n){switch(n.keyCode||n.which){case 13:this.displayWrapper||(n.preventDefault(),this.addLinkButton.click())}return!0},onKeyDown:function(n){switch(n.keyCode||n.which){case 8:if(this.txtElement.val()=="")return this.triggerDeleteBlock(),!1}return!0},onMenuButtonClick:function(){return!0},addLinkClick:function(i,r){var u=t(this);if(u.hasClass("disabled"))return!1;u.addClass("disabled");t.post(n.BuildAJAXUrl("GetLinkAttachment"),{url:r.txtElement.val()},function(n){var i,f;if(n.Error==null)if(i=n.Response.Value,typeof i.embedTag!="undefined"&&i.embedTag.length>0){f=r.baseEditor.attachBlockWithDefaultOptions("EBGallery");f.gal.onVideoEmbedResponse(n);r.baseEditor.deleteBlock(r)}else r.errorContainer&&r.errorContainer.length>0&&r.errorContainer.hide(),r._initLinkPreview(i,u);else r.errorContainer&&r.errorContainer.length>0?r.errorContainer.show():(r.errorContainer=t('<div class="field-validation-error clear mgl txt-bld" style="background: #FF9; padding: 5px 5px 5px 10px;">Could not load url.<\/div> ').appendTo(r.baseElement),r.addLinkButton.removeClass("disabled"))})},_build:function(){if(this.baseElement==null){this.baseElement=t('<div id="EBL'+this.blockID+'" class="wteLinkWrapper editorBlock txt-left clearfix">').appendTo(this.baseEditor.divEditorBlocks).data("blockID",this.blockID).data("editorBlock",this);var n='<div class="loading-element mgt txt-center hide"><img src="/images/ajax-loader.gif"/><\/div><div class="editorWrapper"> <span class="attachBtn attachLink fl" style="cursor: default; margin: 10px 7px 0 10px;"><\/span><input id="EBLtxt'+this.blockID+'" class="wteLink mgb-smaller fl mgt-smaller" type="text" /><div class="btn med silver mgl-small fl" id="EBLbtn'+this.blockID+'" style="margin-top: 3px;">Add<\/div><span class="txt-clr-lighter txt-shadow-btm-med txt-size-normal fl mgl-med btn mgt-small txt-bld delbtn">X<\/span><\/div>';t(n).appendTo(this.baseElement);this.txtElement=this.baseElement.find("#EBLtxt"+this.blockID);this.addLinkButton=this.baseElement.find("#EBLbtn"+this.blockID);this.loadingElement=this.baseElement.find(".loading-element")}},_initEvents:function(){var n=this;n.baseElement.on("focus.whtPostEditor","textarea,input",function(){n.triggerFocusThisBlock()});n.txtElement.on({"keypress.whtPostEditor":function(t){return n.onKeyPress(t)},"keydown.whtPostEditor":function(t){return n.onKeyDown(t)}});n.baseElement.on("click","#EBLbtn"+n.blockID,function(t){n.addLinkClick.apply(this,[t,n])});n.baseElement.on("click",".delbtn",function(){n.triggerDeleteBlock.apply(n)})},_removeImageFromList:function(n,t){for(var i=t.attachmentInfo.Images.slice(0),r=0;r<i.length;r++)i[r]==n&&i.splice(r,1);t.attachmentInfo.Images=i},_initLinkPreview:function(n,i){var r=this,u,f,e;if(r.baseElement.find(".editorWrapper").hide(),r.loadingElement.show(),r.attachmentInfo=t.extend(r.attachmentInfo,n),u='<div class="displayWrapper hide clearfix" style="padding:5px 10px 10px;"><span class="txt-clr-lighter txt-shadow-btm-med txt-size-normal fr btn txt-bld delbtn">X<\/span><input class="wteLinkTitle" id="EBLtxtTitle'+r.blockID+'" type="text" value=""/><div class="slider fl mgr featured-content-slider-container" style="width:150px;"><div class="gallery-navigate previous fl btn small" style="top:0;"><\/div><div class="items">',n.Images&&n.Images.length>0){f="";for(e in n.Images)n.Images.hasOwnProperty(e)&&(f+='<div class="fl txt-center" style="width:150px;"><img src="'+n.Images[e].replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")+'" style="max-width: 150px;height:auto;"/><\/div>');u+=f}u+='<\/div><div class="gallery-navigate next fr btn small" style="top:0;"><\/div><\/div><div class="fl wteLinkDescription"><textarea id="EBLtxtDesc'+r.blockID+'" class="wteLinkDescription"><\/textarea><\/div><\/div>';r.displayWrapper&&r.displayWrapper.length>0&&r.displayWrapper.remove();r.displayWrapper=t(u).appendTo(r.baseElement);r.attachmentInfo.TotalImagesCount=r.attachmentInfo.Images.length;r.attachmentInfo.LoadedImages=0;r.attachmentInfo.MaxHeight=25;r.attachmentInfo.TotalImagesCount<1?r._showDisplayWrapper(r,i):r.displayWrapper.find("img").each(function(){t(this).one("load",function(){r.attachmentInfo.LoadedImages++;var n=t(this),u=n[0].width>0?n[0].width:n[0].naturalWidth,f=n[0].height>0?n[0].height:n[0].naturalHeight;(u<88||f<20)&&(r._removeImageFromList(n.attr("src"),r),n.parent().remove());r.attachmentInfo.LoadedImages>=r.attachmentInfo.TotalImagesCount&&(r.displayWrapper.find("img").off("load"),r._showDisplayWrapper(r,i))}).each(function(){this.complete&&t(this).trigger("load")}).error(function(){r.attachmentInfo.LoadedImages++;var n=t(this),u=n.attr("src");console.error("ERROR Loading Image:",u);r._removeImageFromList(u,r);n.parent().remove();r.attachmentInfo.LoadedImages++;r.attachmentInfo.LoadedImages>=r.attachmentInfo.TotalImagesCount&&(r.displayWrapper.find("img").off("load"),r._showDisplayWrapper(r,i))})})},_showDisplayWrapper:function(i,r){if(i.displayWrapper.show(),i.loadingElement.hide(),i.txtTitle=i.displayWrapper.find("#EBLtxtTitle"+i.blockID),i.txtTitle.val(n.DecodeEntities(i.attachmentInfo.Title)),i.txtDescription=i.displayWrapper.find("#EBLtxtDesc"+i.blockID),i.txtDescription.val(n.DecodeEntities(i.attachmentInfo.Description)),i.txtDescription.autogrow(),i.attachmentInfo.Images&&i.attachmentInfo.Images.length>0){if(i.displayWrapper.find("img").each(function(){var n=t(this);i.attachmentInfo.MaxHeight=n[0].height>i.attachmentInfo.MaxHeight?n[0].height:i.attachmentInfo.MaxHeight}),i.imageSlider=i.displayWrapper.find(".slider").height(i.attachmentInfo.MaxHeight),!i.imageSlider.data("scrollable")){i.imageSlider.scrollable({prev:".previous",clickSpeed:50,itemCount:1});i.imageSlider.scrollable().onSeek(function(n,r){var f=n.currentTarget,e=t(f.getItems().get(r)),u=e.find("img"),o=u.height()>75?u.height():75;i.imageSlider.animate({height:o},50);i.attachmentInfo.SelectedImage=u.attr("src")});i.imageSlider.scrollable().seekTo(0)}(i.attachmentInfo.Images&&i.attachmentInfo.Images.length==1||i.displayWrapper.find(".slider .items img").length==1)&&(i.displayWrapper.find(".gallery-navigate").hide(),i.attachmentInfo.SelectedImage=i.displayWrapper.find(".slider .items img").attr("src"))}else i.displayWrapper.find(".slider").hide(),i.txtDescription.width("100%").parent().width("100%");r&&r.length>0&&r.removeClass("disabled")}})}(window.WHT=window.WHT||{},jQuery),function(n,t){var i=(new Date).getTimezoneOffset();n.CalDay=function(r){var u=this,f=t(r),e,o;for(this.date=n.newDate(f.data("day")),this.resolution=Number(f.data("resolution")),this.year=this.date.getUTCFullYear(),this.month=this.date.getUTCMonth()+1,this.day=this.date.getUTCDate(),this.isToday=f.hasClass("today"),this.$day=f,this.dayCssClass=String(this.year)+"-"+(this.month<10?"0":"")+String(this.month)+"-"+(this.day<10?"0":"")+String(this.day),this.weekday=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][this.date.getUTCDay()],this.wd=["Su","M","T","W","Th","F","Sa"][this.date.getUTCDay()],this.monthName=["January","February","March","April","May","June","July","August","September","October","November","December"][this.date.getUTCMonth()],this.mn=["Jan","Feb","Marc","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][this.date.getUTCMonth()],this.hours=[],this.articleCount=0,this.slotCount=0,this.utcOffsetMinutes=new Date(this.date.getFullYear(),this.date.getMonth(),this.date.getDate(),3,0,0,0).getTimezoneOffset(),this.timeChange={h:Math.floor(Math.abs(i-this.utcOffsetMinutes)/60)*(this.utcOffsetMinutes>i?-1:1),m:(Math.abs(i-this.utcOffsetMinutes)-Math.floor(Math.abs(i-this.utcOffsetMinutes)/60)*60)*(this.utcOffsetMinutes>i?-1:1)},(this.timeChange.h!=0||this.timeChange.m!=0)&&console.log(this.utcOffsetMinutes+","+i+" ("+this.timeChange.h+","+this.timeChange.m+")"),e=0,o=0;e<1440;e+=this.resolution,o++)this.hours[o]={articles:[]};f.find(".time-slot").each(function(){var i=t(this),r=Number(t(this).data("slot-index"));i.find(".slot").each(function(){var f=t(this),s=f.find(".timelabel"),h=Number(f.data("article-id")),e,o,i;u.slotCount++;h!=0&&(u.articleCount++,u.hours[r].articles.push({articleID:h,url:f.data("article-url"),editUrl:f.data("article-url-edit"),dateDue:f.data("date-due")==""?"":n.newDate(f.data("date-due")),datePublish:f.data("date-publish")==""?"":n.newDate(f.data("date-publish")),dateFeature:f.data("date-feature")==""?"":n.newDate(f.data("date-feature")),state:f.data("state")}));s.length>0&&(u.timeChange.h!=0||u.timeChange.m!=0)&&(e=s.text(),e!=""&&(o=e.indexOf("a")>-1,e=e.substr(0,e.length-1),i=e.split(":"),i[0]=Number(i[0]),i[1]=Number(i[1]),i[0]+=u.timeChange.h,i[1]+=u.timeChange.m,i[1]>=60&&(i[1]-=60,i[0]++),i[1]<0&&(i[1]+=60,i[0]--),i[0]>12&&(i[0]-=12),i[0]<0&&(i[0]+=12,o=!o),i[0]==12&&u.timeChange.h>0&&(o=!o),s.text(i[0]+":"+(i[1]<10?"0":"")+i[1]+(o?"a":"p"))))})})};n.CalWriter=function(n,t,i){this.id=n;this.name=t;this.isOnline=i==!0};n.CalWriter.parseFromSelectList=function(i,r){return r==null&&(r=[]),i.each(function(){var i=t(this);if(i.is("option")){var f=i.attr("value"),u=i.text(),e=!1;f.indexOf("u")==0&&(u.indexOf("* ")==0&&(e=!0,u=u.substr(2)),r.push(new n.CalWriter(Number(f.substr(1)),u,e)))}else r=n.CalWriter.parseFromSelectList(i.children(),r)}),r};n.CalWorld=function(n,t){this.id=n;this.name=t};n.CalWorld.parseFromSelectList=function(i,r){return r==null&&(r=[]),i.each(function(){var i=t(this),u,f;i.is("option")?(u=i.attr("value"),f=i.text(),u.indexOf("w")==0&&r.push(new n.CalWorld(Number(u.substr(1)),f))):r=n.CalWorld.parseFromSelectList(i.children(),r)}),r};n.EditorialCalendar=function(i){var v={mode:"self",collapsed:!0,dayPreviewHeight:48,offsetDays:-14,utcOffsetMinutes:(new Date).getTimezoneOffset(),byPublish:!0,userID:0,worldID:0,autoRefresh:12e4},r=this,u=i,a="today",o=u.closest(".sidebar").length>0,f=null,h=[],c=[],e={},s={},l=null;this.init=function(n){this.options=t.extend(v,typeof n=="string"?r._getOptionsFromFilter(n):n);r._initEventHandlers();r._load();!o&&r.options.autoRefresh>0&&(l=setInterval(function(){t("#cal-prompt").length>0||r._reload(null,!0)},r.options.autoRefresh))};this.destroy=function(){console.log("destroying calendar");u&&u.length>0&&u.empty().off();t(window).off(".calBtnMiddleClick").off(".calRefreshListener");o||l==null||clearInterval(l)};this._initEventHandlers=function(){u.on("click","button",this._onButtonClick);u.on("mousedown","button",function(n){if(n.which===2){var i=t(n.target);if(i.is("button")||(i=i.closest("button")),i.is("button")){n.preventDefault();n.stopImmediatePropagation();i.on("mouseup.calBtnMiddleClick",function(n){(t(window).off("mouseup.calBtnMiddleClick"),i.off("mouseup.calBtnMiddleClick"),n.which===2)&&(n.preventDefault(),n.stopImmediatePropagation(),r._onButtonClick(n))});t(window).on("mouseup.calBtnMiddleClick",function(){t(window).off("mouseup.calBtnMiddleClick");i.off("mouseup.calBtnMiddleClick")});u.on("remove",function(){r.destroy()})}}});if(!o)t(document).on("keydown.calRefreshListener",function(t){(t.keyCode||t.which)===82&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),t.stopImmediatePropagation(),n.Alerts.Show("Calendar Refreshing...",!0),r._reload(function(){n.Alerts.Show("Done",!0)}))});!o&&History&&History.enabled&&(Modernizr.history?History.savedStates.length>1&&r._handleHistoryStateChange(!0):(History.options.disableSuid=!0,window.location.href.indexOf("#")>-1&&r._handleHistoryStateChange(!0)),History.Adapter.bind(window,"statechange",r._handleHistoryStateChange))};this._handleHistoryStateChange=function(n){var u,f,i;if(!o){if(u=n===!0?History.savedStates[0]:History.getState(),t.isEmptyObject(u.data))return f=u.hash,console.log(f),!1;i=u.data;(r.options.mode!=i.mode||r.options.worldID!=i.worldID||r.options.userID!=i.userID||r.options.byPublish!=i.byPublish)&&(r.options=t.extend(r.options,i),r._clear(),r._load(null,null,!0))}};this._onButtonClick=function(i){var f=t(i.target),o,u,e;if(f.is("button")||(f=f.closest("button")),o=f.data("action"),u=f.closest(".slot"),i.which===2||i.ctrlKey||i.metaKey){e=null;switch(o){case"slot-more-actions":case"slot-article-view":e=window.open(u.data("article-url"));break;case"slot-assign-times":case"slot-article-edit":if(u.find("button.slot-edit")==0)return;e=window.open(u.data("article-url-edit"));break;default:e=!1}if(e==null&&n.Alerts.DisplayErrorNotification("Please disable your popup blocker to enable middle-click."),i.which===2||e!==!1)return}switch(o){case"slot-assign-writer":if(n.loggedInUser.cd!==1337)break;r._showSlotPrompt(u,o,"Assign to Writer",!0);break;case"slot-assign-times":if(n.loggedInUser.cd!==1337)break;r._showSlotPrompt(u,o,"Set Schedule");break;case"slot-more-actions":if(i.which===2){e=window.open(u.data("article-url"));break}if(u.find(".more-actions button").length<=2){n.NavigateTo(u.data("article-url"));break}u.toggleClass("show-actions",!0);break;case"slot-article-cancel":u.toggleClass("show-actions",!1);break;case"slot-article-view":n.NavigateTo(u.data("article-url"));break;case"slot-article-edit":n.NavigateTo(u.data("article-url-edit"));break;case"slot-article-delete":r._deleteArticle(u);break;case"cal-show-month":case"cal-show-day":r._jumpToDay(f.closest(".cal-list-day, .cal-list-month").first().data("day").split("T")[0]);break;case"day-toggle-collapse":f.closest(".cal-day").toggleClass("collapsed");r._normalizeRowHeights();break;case"slot-prompt-save":r._saveOpenSlotPrompt();break;case"slot-prompt-close":t("#cal-prompt").remove()}i.stopImmediatePropagation()};this._deleteArticle=function(i){var r=Number(i.data("article-id")||0),u=Number(i.data("revision-id")||0),f=i.data("world-url")||"";if(r==0||u==0||f==""){n.Alerts.DisplayErrorNotification("Sorry, this article cannot be deleted. (Error "+r+"."+u+"."+f+")");return}confirm("Are you sure you want to delete this article? This cannot be undone.")&&t.post(n.BuildAJAXUrl("deletearticle"),{articleid:r,articlerevisionid:u,worldurlname:f},function(t){t.Error?n.Alerts.DisplayErrorNotification(t.Error.ErrorText):n.DeleteAnimation(i)})};this._showSlotPrompt=function(i,u,f,e){var ut=t("#cal-prompt"),ft=i.closest(".time-slot"),lt=Number(ut.data("article-id")),at=ut.data("action"),st,b,it,ht,l,d,rt,s,tt;ut.remove();var k=Number(i.data("author-id")||0),g=Number(i.data("article-id")||0),a=Number(i.data("world-id")||0),ct=i.data("world-url")||"",et=i.data("article-title")||"",nt=!ft.data("time")||ft.data("time")==""?"":n.newDate(ft.data("time")),ot=!i.data("date-due")||i.data("date-due")==""?"":n.newDate(i.data("date-due"),!0),v=!i.data("date-publish")||i.data("date-publish")==""?"":n.newDate(i.data("date-publish"),!0),w=!i.data("date-feature")||i.data("date-feature")==""?"":n.newDate(i.data("date-feature"),!0);if(g==0||g!=lt||u!=at){$prompt=t(t.format('<div class="cal-prompt{0}" id="cal-prompt"><h3><\/h3><\/div>',e?" right-side":"")).data("action",u).data("article-id",g).data("article-title",et).data("original-title",et).data("author-id",k!=0?k:"").data("world-id",a>0?a:"").data("world-url",ct).data("date-due",i.data("date-due")||"").data("date-publish",i.data("date-publish")||"").data("date-feature",i.data("date-feature")||"");$prompt.children().first().text(f);switch(u){case"slot-assign-writer":var s=$prompt.prepend('<div class="advanced-options"><h3>Set Title<\/h3><\/div>').find("div").first().hide(),tt=$prompt.prepend('<i class="fa fa-ellipsis-v"><\/i>').find("i").first().on("click",function(){s.fadeIn(200);tt.off("click").remove()}),y=s.append('<input type="text" placeholder="Enter Title"/>').find("input").last().val(et),p=$prompt.append("<select><\/select>").find("select").last(),o=s.append("<div><h3>Publish Under<\/h3><select><\/select><\/div>").find("select").last();for($worldOther=s.append('<input type="text" placeholder="Enter World URL"/>').find("input").last().hide(),st=!1,l=0;l<h.length;l++)b=h[l],it=k===b.id,it&&(st=!0),p.append(t.format('<option value="{0}"{3}>{1}{2}<\/option>',b.id,b.isOnline?"* ":"",it?"&gt; "+b.name+" &lt;":b.name,it?' style="font-weight:bold" selected="selected"':""));for(!st&&k>0&&p.append(t.format('<option value="{0}" selected="selected">&gt; {1} &lt;<\/option>',k,"Non-Staff Writer")),ht=!1,l=0;l<c.length;l++)d=c[l],rt=a===d.id,rt&&(ht=!0),o.append(t.format('<option value="{0}"{2}>{1}<\/option>',d.id,rt?"&gt; "+d.name+" &lt;":d.name,rt?' style="font-weight:bold" selected="selected"':""));!ht&&a>0&&o.append(t.format('<option value="{0}" selected="selected">&gt; {1} &lt;<\/option>',a,ct));o.append('<option value="">Other...<\/option>');g==0&&(v==""&&nt!=""&&(v=nt),r.options.byPublish||w!=""||nt==""||(w=nt,$prompt.data("date-feature",w.toISOString())),$prompt.data("date-publish",v.toISOString()).data("world-id",o.val()).data("author-id",p.val()),s.show(),tt.off("click").remove(),s.append("<h3>Set Schedule<\/h3>"),r._appendDateSelect(s,"date-due",ot),r._appendDateSelect(s,"date-publish",v),r._appendDateSelect(s,"date-feature",w));o.on("change",function(){if($prompt.data("world-id",o.val()),o.val()==""){o.hide();var n=function(){var n=$worldOther.off("blur keypress").hide().val();o.show().val(n);o.val()!=n&&(o.find("option").last().before(t.format('<option value="{0}">{0}<\/option>',n)),o.val(n));n==""&&o.val(a>0?a:o.find("option").first().attr("value"));$prompt.data("world-id",o.val())};$worldOther.show().focus().on("blur",n).on("keypress",function(t){t.keyCode==13&&n()})}});t([y,p,o,$worldOther]).map(function(){return this.toArray()}).on("change blur keydown",function(){$prompt.data("article-title",y.val()).data("author-id",p.val()).data("world-id",o.val())});y.on("blur keydown",function(i){var u,f,e;(i.type=="blur"||i.which===13)&&(u=y.val(),f=/^[0-9\-]+$/.test(u)?Number(u):n.getArticleIDFromUrl(u),f!=0&&(e=$prompt.find("input, select, button"),e.prop("disabled",!0),t.post(n.BuildAJAXUrl("getcalarticle"),{utcoffsetminutes:r.options.utcOffsetMinutes,articleid:f},function(i){var u,f;e.prop("disabled",!1);y.val("");i.Error?n.Alerts.DisplayErrorNotification(i.Error.ErrorText):(u=i.Response.Value,u.dateDue=u.Due==""?"":n.newDate(u.Due,!0),u.datePublish=u.Publish==""?"":n.newDate(u.Publish,!0),u.dateFeature=u.Feature==""?"":n.newDate(u.Feature,!0),console.dir(u),y.val(u.Title),r._upsertSelectVal(o,u.WorldID,"&gt; "+u.WorldName+" &lt;"),r._upsertSelectVal(p,u.AuthorID,"&gt; "+u.AuthorName+" &lt;"),r._upsertDateSelectVal("date-due",u.dateDue),u.datePublish!=""&&r._upsertDateSelectVal("date-publish",u.datePublish),u.dateFeature!=""&&(f=r._splitDateParts(u.dateFeature),confirm(u.Title+" is already scheduled to be featured at "+f.time+" on "+f.date+".\n\nWould You Like to re-assign it?")||r._upsertDateSelectVal("date-feature",u.dateFeature)));$prompt.data("article-id",u.ArticleID).data("article-title",y.val()).data("author-id",p.val()).data("world-id",o.val()).data("world-url","");t("#date-due-day, #date-due-time, #date-publish-day, #date-publish-time, #date-feature-day, #date-feature-time").trigger("change")})))});break;case"slot-assign-times":s=$prompt.prepend('<div class="advanced-options"><h3>Set Full Schedule<\/h3><\/div>').find("div").first().hide();tt=$prompt.prepend('<i class="fa fa-ellipsis-v"><\/i>').find("i").first().on("click",function(){s.fadeIn(200);tt.off("click").remove()});switch(r.options.mode){case"global":case"world":console.dir(v);r._appendDateSelect(s,"date-due",ot);r._appendDateSelect(r.options.byPublish?$prompt:s,"date-publish",v);r._appendDateSelect(r.options.byPublish?s:$prompt,"date-feature",w);break;default:r._appendDateSelect($prompt,"date-due",ot);r._appendDateSelect(s,"date-publish",v);r._appendDateSelect(s,"date-feature",w)}}$prompt.append('<button type="button" class="raised-btn" data-action="slot-prompt-save">Save<\/button>').append('<button type="button" class="raised-btn" data-action="slot-prompt-close">Cancel<\/button>');$prompt.hide();i.append($prompt);$prompt.fadeIn(150);t("#date-due-day, #date-due-time, #date-publish-day, #date-publish-time, #date-feature-day, #date-feature-time").on("change",function(){var n=r._getDateSelectVal("date-due"),t=r._getDateSelectVal("date-publish"),i=r._getDateSelectVal("date-feature");console.dir([n,t,i]);$prompt.data("date-due",n?n.toISOString():$prompt.data("date-due")!=""?0:"").data("date-publish",t?t.toISOString():$prompt.data("date-publish")!=""?0:"").data("date-feature",i?i.toISOString():$prompt.data("date-feature")!=""?0:"");console.dir([$prompt.data("date-due"),$prompt.data("date-publish"),$prompt.data("date-feature")])})}};this._saveOpenSlotPrompt=function(){var i=t("#cal-prompt"),o;if(!(i.length<=0)){console.dir([i.data("date-due"),i.data("date-publish"),i.data("date-feature")]);var y=i.data("action"),h=Number(i.data("article-id")||0),c=Number(i.data("author-id")||0),l=String(Number(i.data("world-id")))=="NaN"?0:Number(i.data("world-id")||0),a=String(Number(i.data("world-id")))=="NaN"?i.data("world-id")||"":"",s=i.data("article-title")||"",v=i.data("original-title")||"",u=i.data("date-due")===0?0:i.data("date-due")==""?"":n.newDate(i.data("date-due"),!0),f=i.data("date-publish")===0?0:i.data("date-publish")==""?"":n.newDate(i.data("date-publish"),!0),e=i.data("date-feature")===0?0:i.data("date-feature")==""?"":n.newDate(i.data("date-feature"),!0);if(s==""){n.Alerts.DisplayErrorNotification("Please enter a Title",1e3);return}o={articleid:h,authorid:c,worldid:l,worldurl:a,articletitle:s!=v||h==0?s:"",utcoffsetminutes:r.options.utcOffsetMinutes};(u===0||u!=""&&u!=null)&&(o.due=u===0?"0":u.toISOString());(f===0||f!=""&&f!=null)&&(o.publish=f===0?"0":f.toISOString());(e===0||e!=""&&e!=null)&&(o.feature=e===0?"0":e.toISOString());t.post(n.BuildAJAXUrl("updatearticleschedule"),o,function(t){if(t.Error)n.Alerts.DisplayErrorNotification(t.Error.ErrorText);else{var u=t.Response.Value;i.remove();n.Alerts.Show("Saved. Updating Calendar...");r._reload()}}).error(function(){n.Alerts.DisplayErrorNotification("Unexpected Error Saving Changes")})}};this._appendDateSelect=function(n,i,u){var e=r._splitDateParts(u),h=n.append('<div class="clearfix"><\/div>').find("div").last(),s=h.append(t.format('<select id="{0}-time" class="time"><\/select>',i)).find("select"),o=s[0],c=h.append(t.format('<input type="date" id="{0}-day" class="date time"/>',i)).find("input").last().val(e.day),f;for(h.append(t.format('<label for="{0}-day">{1}<\/label>',i,i=="date-publish"?"Publish":i=="date-feature"?"Feature":"Draft Due")),f=0;f<1440;f+=60)f==0&&(o.options[0]=new Option(r._minutesToTimeStamp(-1),"-1",e.min==-1)),e.min!=f&&(o.options[o.options.length]=new Option(r._minutesToTimeStamp(f),f)),e.min>=f&&e.min<f+60&&(o.options[o.options.length]=new Option(r._minutesToTimeStamp(e.min),e.min,!0));o.value=e.min;s.on("change",function(){s.val()=="-1"&&(c.val(""),s.val("-1"))})};this._splitDateParts=function(n){var i=n==""?"":n.getFullYear()+"-"+r._zeroPad(n.getMonth()+1,2)+"-"+r._zeroPad(n.getDate(),2),u=n==""?"":String(n.getMonth()+1)+"/"+String(n.getDate())+"/"+n.getFullYear(),t=n==""?-1:n.getHours()*60+n.getMinutes(),f=r._minutesToTimeStamp(t);return{day:i,date:u,min:t,time:f}};this._minutesToTimeStamp=function(n){if(n==-1)return"- - : - -";var t=720,u=n>=t?"pm":"am",i=Math.floor((n==0?t:n>t?n-t:n)/60),f=(n>t?n-t:n)-(n==0?0:i*60);return(i==0?12:i)+":"+r._zeroPad(f,2)+u};this._getDateSelectVal=function(i){var u=t("#"+i+"-day").val(),r=t("#"+i+"-time").val(),f,e;return u==""||u==null?null:((r==""||r==null||r=="-1")&&(r=300),u=String(u).substr(0,10),r=Number(r),f=n.newDate(u+"T00:00:00Z",!0),e=new Date(f.getTime()+(f.getTimezoneOffset()+r)*6e4),console.log(e),e)};this._upsertDateSelectVal=function(n,i){var u=r._splitDateParts(i),f=t("#"+n+"-day"),e=t("#"+n+"-time");f.val(u.day);r._upsertSelectVal(e,u.min,u.time)};this._upsertSelectVal=function(n,i,r){i=String(i);n.val(i);n.val()!=i&&(n.find("option").first().before(t.format('<option value="{0}">{1}<\/option>',i,r)),n.val(i))};this._zeroPad=function(n,t){while(String(n).length<t)n="0"+String(n);return n};this._jumpToDay=function(n){var i=u.find(".cal-day."+(n||a)),t,r;i.length>0&&(a=n,window.scrollBy(0,i[0].getBoundingClientRect().top-120),t=i.find(".day-header"),r=t.css("background-color"),t.css("background-color","#5BBB5C").transition("0.5s background-color"),setTimeout(function(){t.css("background-color",r)},250),setTimeout(function(){t.transition().css("background-color","")},1e3))};this._reload=function(i,f){var e={expanded:[],scrollTop:t(window).scrollTop()};r._load(null,function(){n.scrollTo(0,e.scrollTop);u.find(e.expanded.join(", ")).removeClass("collapsed");r._normalizeRowHeights();i!=null&&typeof i=="function"&&i()},!0,function(){if(f&&t("#cal-prompt").length>0)return!1;var n=[];return u.find(".cal-day:not(.collapsed)").each(function(){for(var i,u=t(this).attr("class").split(" "),f="",r=0;r<u.length;r++)i=u[r].trim(),i!=""&&(f+="."+i);i!=""&&n.push(f)}),e={expanded:n,scrollTop:t(window).scrollTop()},!0})};this._clear=function(){f!=null&&(f.off("change"),f.remove(),f=null,h=[],c=[]);u.empty();e={};s={}};this._load=function(i,u,f,e){switch(r.options.mode){case"global":t.post(n.BuildAJAXUrl("geteditorialcalendar"),{daysoffset:i||r.options.offsetDays,utcoffsetminutes:r.options.utcOffsetMinutes,bypublish:r.options.byPublish},function(n){var t=!0;typeof e=="function"&&(t=e.apply(r,[]));t&&r._initCalResponse(n,u,f)});break;case"world":t.post(n.BuildAJAXUrl("geteditorialcalendarforworld"),{daysoffset:i||r.options.offsetDays,utcoffsetminutes:r.options.utcOffsetMinutes,worldid:r.options.worldID},function(n){var t=!0;typeof e=="function"&&(t=e.apply(r,[]));t&&r._initCalResponse(n,u,f)});break;case"self":r.options.userID=n.loggedInUser.UserID;case"writer":default:r.options.userID<=0&&(r.options.userID=n.loggedInUser.UserID);t.post(n.BuildAJAXUrl("geteditorialcalendarforauthor"),{daysoffset:i||r.options.offsetDays,utcoffsetminutes:r.options.utcOffsetMinutes,authoruserid:r.options.userID},function(n){var t=!0;typeof e=="function"&&(t=e.apply(r,[]));t&&r._initCalResponse(n,u,f)})}};this._initCalResponse=function(i,u,l){var v=t(i),a;r._clear();f!=null&&(f.off("change"),f.remove(),f=null);f=v.find("#calfilter").removeAttr("id").removeAttr("name");h=n.CalWriter.parseFromSelectList(f);c=n.CalWorld.parseFromSelectList(f);!o&&l!==!0&&History&&History.enabled&&(a=f.val(),a==""&&(a="by-publish-date"),a=="featured"&&(a=""),a!=""&&(a+="/"),a="/cal/"+a,History.pushState({mode:r.options.mode,worldID:r.options.worldID,userID:r.options.userID,byPublish:r.options.byPublish},document.title,a));v.find(".cal-day").each(function(i,r){var u=t(r),f;u.hasClass("unscheduled")?s[u.data("unscheduled-id")]=u:(f=new n.CalDay(u),e[f.date.valueOf()]=f)});r._renderCal();u!=null&&typeof u=="function"&&u()};this._renderCal=function(){var rt=0,c,k,l,tt,d,ut,b,g,it,a;for(var v in e)rt+=e[v].articleCount;if(o)this._appendKey();else{if(c=u.find(".hscrollable ul"),c.length==0){u.empty().append('<div class="toolbox-anchor"><div class="lockable-toolbox cal-list"><div class="hscrollable" data-margin-between-items="2"><ul class="inline clearfix"><\/ul><\/div><\/div><\/div>');c=u.find(".hscrollable ul");c.on("click","button",this._onButtonClick)}else u.find();this._appendKey();for(v in e){var i=e[v],p=!0,h=c.find("."+i.dayCssClass).empty();h.length==0&&(p=!1,h=t('<li class="item snappable cal-list-day '+i.dayCssClass+(i.day==1?" isfirst":"")+(i.isToday?" today":"")+'" data-day="'+i.date.toISOString()+'"><\/li>'));var y=0,nt=100*(r.options.dayPreviewHeight/i.hours.length/r.options.dayPreviewHeight),w=t('<span class="cal-day-preview"><\/span>');for(k=0;k<i.hours.length;k++)if(l=i.hours[k],l.articles.length>0)if(y>0&&(w.append('<span style="height:'+y+'%"><\/span>'),y=0),l.articles.length>1){for(tt=t('<span class="preview-state state-'+l.articles[0].state+' multi-state" style="height:'+nt+'%;"><\/span>'),d=l.articles.length-1;d>=0;d--)tt.append('<span class="preview-state state-'+l.articles[d].state+'" style="width:'+100/l.articles.length+'%;height:100%;"><\/span>');w.append(tt)}else w.append('<span class="preview-state state-'+l.articles[0].state+'" style="height:'+nt+'%;"><\/span>');else y+=nt;y>0&&w.append('<span style="height:'+y+'%"><\/span>');h.append('<button type="button" data-action="cal-show-day"><strong>'+i.wd+"<\/strong> <em>"+i.day+"<\/em><\/button>").find("button").append(w);p||(ut=h.data("day"),c.find(".cal-list-day").each(function(){if(!p){var n=t(this),r=n.data("day");r>ut&&(h.insertBefore(n),h.hasClass("isfirst")&&(h.prev().toggleClass("islast",!0),t('<li class="item snappable cal-list-month" data-day="'+i.date.toISOString()+'"><button type="button" data-action="cal-show-month"><strong>'+i.mn+"<\/strong><\/button><\/li>").insertBefore(h)),p=!0)}}),p||(h.hasClass("isfirst")&&c.append('<li class="item snappable cal-list-month" data-day="'+i.date.toISOString()+'"><button type="button" data-action="cal-show-month"><strong>'+i.mn+"<\/strong><\/button><\/li>"),c.append(h),h.hasClass("isfirst")&&h.prev().prev().toggleClass("islast",!0)))}u.append('<div class="dropdown-bar"><\/div>').find(".dropdown-bar").append(f);f.on("change",function(){r.options=t.extend(r.options,r._getOptionsFromFilter(t(this).val()));r._clear();r._load()})}b=u.find(".cal-days").empty();g=u.find(".unscheduled-list").empty();b.length==0&&(b=u.append('<div class="unscheduled-list clearfix"><\/div><div class="cal-days clearfix"><\/div>').find(".cal-days"),g=u.find(".unscheduled-list"));it=!1;for(a in s)(r.options.mode=="self"||r.options.mode=="writer")&&(a=="overdue"||a=="pitches"||a=="unscheduleddrafts")&&Number(s[a].data("article-count"))>0&&s[a].toggleClass("collapsed",!1),g.append(s[a]);o&&!it&&rt>0&&(it=!0,g.append('<div class="clearfix"><\/div>').append('<div class="menu-section-heading mtop">My Draft Calendar<\/div>'));for(v in e)(!o||e[v].articleCount>0)&&b.append(e[v].$day);r.options.collapsed&&b.find(".cal-day").toggleClass("collapsed",!0);r._normalizeRowHeights();n.OnElementReady()};this._appendKey=function(){var n;if(!(u.find(".status-key").length>0)){var i=t('<div class="status-key"><i class="fa fa-key"><\/i><div class="key-box"><\/div><\/div>'),f=i.find("div").append('<h2><i class="fa fa-key"><\/i> Key<\/h2>').append("<ul><\/ul>").find("ul"),r={1:"Idea",5:"Pitch",10:"Draft",20:"Draft - Needs Revision",30:"Needs Editing",32:"In Final Review",35:"Done - Saved For Later",40:"Done - Queued to Publish",200:"Published",250:"Published &amp; Featured"};for(n in r)f.append('<li class="state-{0}"><span class="slot-state"><\/span>{1}<\/li>'.format(n,r[n]));u.append(i)}};this._getOptionsFromFilter=function(n){return/^w[0-9]+/.test(n)?{mode:"world",worldID:Number(n.substr(1)),userID:0,byPublish:!0}:/^u[0-9]+/.test(n)?{mode:"writer",worldID:0,userID:Number(n.substr(1)),byPublish:!0}:n==="featured"?{mode:"global",worldID:0,userID:0,byPublish:!1}:{mode:"global",worldID:0,userID:0,byPublish:!0}};this._normalizeRowHeights=function(){var o=51,s,h,n,f,t;for(s in e){var i=e[s],r=[],u=o*(i.$day.hasClass("collapsed")?i.articleCount:i.slotCount);for(h in e)n=e[h],i.$day[0].offsetTop==n.$day[0].offsetTop&&(f=o*(n.$day.hasClass("collapsed")?n.articleCount:n.slotCount),f>u&&(u=f),r.push(n));for(t=0;t<r.length;t++)r[t].$day.find(".day-list").height(t==r.length-1?u+1:u)}}};t.fn.whtcal=function(i){return this.each(function(){var r=t(this),u;if(r.data("whtcal"))return r.data("whtcal");u=new n.EditorialCalendar(r);r.data("whtcal",u);u.init(i!=null?i:typeof i=="string"?"":{})})}}(window.WHT=window.WHT||{},jQuery);